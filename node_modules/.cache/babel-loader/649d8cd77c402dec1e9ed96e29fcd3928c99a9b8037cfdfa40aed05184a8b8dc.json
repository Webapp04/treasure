{"ast":null,"code":"import _regeneratorRuntime from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nfunction noop() {}\nexport function create() {\n  var chunkQueue = [];\n  var drainer = null;\n  var _drainerResolver = noop;\n  var ended = false;\n  var outWait = null;\n  var _outWaitResolver = noop;\n  var makeDrainer = function makeDrainer() {\n    if (!drainer) {\n      drainer = new Promise(function (resolve) {\n        _drainerResolver = function drainerResolver() {\n          drainer = null;\n          _drainerResolver = noop;\n          resolve();\n        };\n      });\n    }\n    return drainer;\n  };\n  var writer = {\n    write: function write(chunk) {\n      chunkQueue.push(chunk);\n      var drainer = makeDrainer();\n      _outWaitResolver();\n      return drainer;\n    },\n    end: function end() {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var drainer;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              ended = true;\n              drainer = makeDrainer();\n              _outWaitResolver();\n              _context.next = 5;\n              return drainer;\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    }\n  };\n  var iterator = {\n    next: function next() {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var chunk;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              chunk = chunkQueue.shift();\n              if (!chunk) {\n                _context2.next = 4;\n                break;\n              }\n              if (chunkQueue.length === 0) {\n                _drainerResolver();\n              }\n              return _context2.abrupt(\"return\", {\n                done: false,\n                value: chunk\n              });\n            case 4:\n              if (!ended) {\n                _context2.next = 7;\n                break;\n              }\n              _drainerResolver();\n              return _context2.abrupt(\"return\", {\n                done: true,\n                value: undefined\n              });\n            case 7:\n              if (!outWait) {\n                outWait = new Promise(function (resolve) {\n                  _outWaitResolver = function outWaitResolver() {\n                    outWait = null;\n                    _outWaitResolver = noop;\n                    return resolve(iterator.next());\n                  };\n                });\n              }\n              return _context2.abrupt(\"return\", outWait);\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }))();\n    }\n  };\n  return {\n    writer: writer,\n    iterator: iterator\n  };\n}","map":{"version":3,"names":["noop","create","chunkQueue","drainer","drainerResolver","ended","outWait","outWaitResolver","makeDrainer","Promise","resolve","writer","write","chunk","push","end","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","stop","iterator","_callee2","_callee2$","_context2","shift","length","abrupt","done","value","undefined"],"sources":["/Users/apple/Documents/treasure/node_modules/@ipld/car/esm/lib/iterator-channel.js"],"sourcesContent":["function noop() {\n}\nexport function create() {\n  const chunkQueue = [];\n  let drainer = null;\n  let drainerResolver = noop;\n  let ended = false;\n  let outWait = null;\n  let outWaitResolver = noop;\n  const makeDrainer = () => {\n    if (!drainer) {\n      drainer = new Promise(resolve => {\n        drainerResolver = () => {\n          drainer = null;\n          drainerResolver = noop;\n          resolve();\n        };\n      });\n    }\n    return drainer;\n  };\n  const writer = {\n    write(chunk) {\n      chunkQueue.push(chunk);\n      const drainer = makeDrainer();\n      outWaitResolver();\n      return drainer;\n    },\n    async end() {\n      ended = true;\n      const drainer = makeDrainer();\n      outWaitResolver();\n      await drainer;\n    }\n  };\n  const iterator = {\n    async next() {\n      const chunk = chunkQueue.shift();\n      if (chunk) {\n        if (chunkQueue.length === 0) {\n          drainerResolver();\n        }\n        return {\n          done: false,\n          value: chunk\n        };\n      }\n      if (ended) {\n        drainerResolver();\n        return {\n          done: true,\n          value: undefined\n        };\n      }\n      if (!outWait) {\n        outWait = new Promise(resolve => {\n          outWaitResolver = () => {\n            outWait = null;\n            outWaitResolver = noop;\n            return resolve(iterator.next());\n          };\n        });\n      }\n      return outWait;\n    }\n  };\n  return {\n    writer,\n    iterator\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}