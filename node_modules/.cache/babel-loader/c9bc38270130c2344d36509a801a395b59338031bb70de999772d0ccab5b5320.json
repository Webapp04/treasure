{"ast":null,"code":"import _classCallCheck from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n// ported from https://www.npmjs.com/package/fast-fifo\nvar FixedFIFO = /*#__PURE__*/function () {\n  function FixedFIFO(hwm) {\n    _classCallCheck(this, FixedFIFO);\n    if (!(hwm > 0) || (hwm - 1 & hwm) !== 0) {\n      throw new Error('Max size for a FixedFIFO should be a power of two');\n    }\n    this.buffer = new Array(hwm);\n    this.mask = hwm - 1;\n    this.top = 0;\n    this.btm = 0;\n    this.next = null;\n  }\n  _createClass(FixedFIFO, [{\n    key: \"push\",\n    value: function push(data) {\n      if (this.buffer[this.top] !== undefined) {\n        return false;\n      }\n      this.buffer[this.top] = data;\n      this.top = this.top + 1 & this.mask;\n      return true;\n    }\n  }, {\n    key: \"shift\",\n    value: function shift() {\n      var last = this.buffer[this.btm];\n      if (last === undefined) {\n        return undefined;\n      }\n      this.buffer[this.btm] = undefined;\n      this.btm = this.btm + 1 & this.mask;\n      return last;\n    }\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return this.buffer[this.btm] === undefined;\n    }\n  }]);\n  return FixedFIFO;\n}();\nexport var FIFO = /*#__PURE__*/function () {\n  function FIFO() {\n    var _options$splitLimit;\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, FIFO);\n    this.hwm = (_options$splitLimit = options.splitLimit) !== null && _options$splitLimit !== void 0 ? _options$splitLimit : 16;\n    this.head = new FixedFIFO(this.hwm);\n    this.tail = this.head;\n    this.size = 0;\n  }\n  _createClass(FIFO, [{\n    key: \"calculateSize\",\n    value: function calculateSize(obj) {\n      if ((obj === null || obj === void 0 ? void 0 : obj.byteLength) != null) {\n        return obj.byteLength;\n      }\n      return 1;\n    }\n  }, {\n    key: \"push\",\n    value: function push(val) {\n      if ((val === null || val === void 0 ? void 0 : val.value) != null) {\n        this.size += this.calculateSize(val.value);\n      }\n      if (!this.head.push(val)) {\n        var prev = this.head;\n        this.head = prev.next = new FixedFIFO(2 * this.head.buffer.length);\n        this.head.push(val);\n      }\n    }\n  }, {\n    key: \"shift\",\n    value: function shift() {\n      var _val;\n      var val = this.tail.shift();\n      if (val === undefined && this.tail.next != null) {\n        var next = this.tail.next;\n        this.tail.next = null;\n        this.tail = next;\n        val = this.tail.shift();\n      }\n      if (((_val = val) === null || _val === void 0 ? void 0 : _val.value) != null) {\n        this.size -= this.calculateSize(val.value);\n      }\n      return val;\n    }\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return this.head.isEmpty();\n    }\n  }]);\n  return FIFO;\n}();","map":{"version":3,"names":["FixedFIFO","hwm","_classCallCheck","Error","buffer","Array","mask","top","btm","next","_createClass","key","value","push","data","undefined","shift","last","isEmpty","FIFO","_options$splitLimit","options","arguments","length","splitLimit","head","tail","size","calculateSize","obj","byteLength","val","prev","_val"],"sources":["/Users/apple/Documents/treasure/node_modules/it-pushable/src/fifo.ts"],"sourcesContent":["// ported from https://www.npmjs.com/package/fast-fifo\n\nimport type { Next } from './index.js'\n\nclass FixedFIFO<T> {\n  public buffer: Array<Next<T> | undefined>\n  private readonly mask: number\n  private top: number\n  private btm: number\n  public next: FixedFIFO<T> | null\n\n  constructor (hwm: number) {\n    if (!(hwm > 0) || ((hwm - 1) & hwm) !== 0) {\n      throw new Error('Max size for a FixedFIFO should be a power of two')\n    }\n\n    this.buffer = new Array(hwm)\n    this.mask = hwm - 1\n    this.top = 0\n    this.btm = 0\n    this.next = null\n  }\n\n  push (data: Next<T>) {\n    if (this.buffer[this.top] !== undefined) {\n      return false\n    }\n\n    this.buffer[this.top] = data\n    this.top = (this.top + 1) & this.mask\n\n    return true\n  }\n\n  shift () {\n    const last = this.buffer[this.btm]\n\n    if (last === undefined) {\n      return undefined\n    }\n\n    this.buffer[this.btm] = undefined\n    this.btm = (this.btm + 1) & this.mask\n    return last\n  }\n\n  isEmpty () {\n    return this.buffer[this.btm] === undefined\n  }\n}\n\nexport interface FIFOOptions {\n  /**\n   * When the queue reaches this size, it will be split into head/tail parts\n   */\n  splitLimit?: number\n}\n\nexport class FIFO<T> {\n  public size: number\n  private readonly hwm: number\n  private head: FixedFIFO<T>\n  private tail: FixedFIFO<T>\n\n  constructor (options: FIFOOptions = {}) {\n    this.hwm = options.splitLimit ?? 16\n    this.head = new FixedFIFO<T>(this.hwm)\n    this.tail = this.head\n    this.size = 0\n  }\n\n  calculateSize (obj: any): number {\n    if (obj?.byteLength != null) {\n      return obj.byteLength\n    }\n\n    return 1\n  }\n\n  push (val: Next<T>) {\n    if (val?.value != null) {\n      this.size += this.calculateSize(val.value)\n    }\n\n    if (!this.head.push(val)) {\n      const prev = this.head\n      this.head = prev.next = new FixedFIFO<T>(2 * this.head.buffer.length)\n      this.head.push(val)\n    }\n  }\n\n  shift () {\n    let val = this.tail.shift()\n\n    if (val === undefined && (this.tail.next != null)) {\n      const next = this.tail.next\n      this.tail.next = null\n      this.tail = next\n      val = this.tail.shift()\n    }\n\n    if (val?.value != null) {\n      this.size -= this.calculateSize(val.value)\n    }\n\n    return val\n  }\n\n  isEmpty () {\n    return this.head.isEmpty()\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}