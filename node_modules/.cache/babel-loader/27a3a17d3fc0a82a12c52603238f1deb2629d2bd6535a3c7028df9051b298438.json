{"ast":null,"code":"import _classCallCheck from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _get from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _wrapNativeSuper from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js\";\nvar TrackedMap = /*#__PURE__*/function (_Map) {\n  _inherits(TrackedMap, _Map);\n  var _super = _createSuper(TrackedMap);\n  function TrackedMap(init) {\n    var _this;\n    _classCallCheck(this, TrackedMap);\n    _this = _super.call(this);\n    var system = init.system,\n      component = init.component,\n      metric = init.metric,\n      metrics = init.metrics;\n    _this.system = system !== null && system !== void 0 ? system : 'libp2p';\n    _this.component = component;\n    _this.metric = metric;\n    _this.metrics = metrics;\n    _this.updateComponentMetric();\n    return _this;\n  }\n  _createClass(TrackedMap, [{\n    key: \"set\",\n    value: function set(key, value) {\n      _get(_getPrototypeOf(TrackedMap.prototype), \"set\", this).call(this, key, value);\n      this.updateComponentMetric();\n      return this;\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(key) {\n      var deleted = _get(_getPrototypeOf(TrackedMap.prototype), \"delete\", this).call(this, key);\n      this.updateComponentMetric();\n      return deleted;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      _get(_getPrototypeOf(TrackedMap.prototype), \"clear\", this).call(this);\n      this.updateComponentMetric();\n    }\n  }, {\n    key: \"updateComponentMetric\",\n    value: function updateComponentMetric() {\n      this.metrics.updateComponentMetric({\n        system: this.system,\n        component: this.component,\n        metric: this.metric,\n        value: this.size\n      });\n    }\n  }]);\n  return TrackedMap;\n}( /*#__PURE__*/_wrapNativeSuper(Map));\nexport function trackedMap(config) {\n  var system = config.system,\n    component = config.component,\n    metric = config.metric,\n    metrics = config.metrics;\n  var map;\n  if (metrics != null) {\n    map = new TrackedMap({\n      system: system,\n      component: component,\n      metric: metric,\n      metrics: metrics\n    });\n  } else {\n    map = new Map();\n  }\n  return map;\n}","map":{"version":3,"names":["TrackedMap","_Map","_inherits","_super","_createSuper","init","_this","_classCallCheck","call","system","component","metric","metrics","updateComponentMetric","_createClass","key","value","set","_get","_getPrototypeOf","prototype","_delete","deleted","clear","size","_wrapNativeSuper","Map","trackedMap","config","map"],"sources":["/Users/apple/Documents/treasure/node_modules/@libp2p/tracked-map/src/index.ts"],"sourcesContent":["import type { ComponentMetricsTracker } from '@libp2p/interface-metrics'\n\nexport interface TrackedMapInit {\n  metrics: ComponentMetricsTracker\n  system?: string\n  component: string\n  metric: string\n}\n\nclass TrackedMap<K, V> extends Map<K, V> {\n  private readonly system: string\n  private readonly component: string\n  private readonly metric: string\n  private readonly metrics: ComponentMetricsTracker\n\n  constructor (init: TrackedMapInit) {\n    super()\n\n    const { system, component, metric, metrics } = init\n    this.system = system ?? 'libp2p'\n    this.component = component\n    this.metric = metric\n    this.metrics = metrics\n\n    this.updateComponentMetric()\n  }\n\n  set (key: K, value: V) {\n    super.set(key, value)\n    this.updateComponentMetric()\n    return this\n  }\n\n  delete (key: K) {\n    const deleted = super.delete(key)\n    this.updateComponentMetric()\n    return deleted\n  }\n\n  clear () {\n    super.clear()\n    this.updateComponentMetric()\n  }\n\n  private updateComponentMetric () {\n    this.metrics.updateComponentMetric({\n      system: this.system,\n      component: this.component,\n      metric: this.metric,\n      value: this.size\n    })\n  }\n}\n\nexport interface CreateTrackedMapOptions {\n  metrics?: ComponentMetricsTracker\n  system?: string\n  component: string\n  metric: string\n}\n\nexport function trackedMap <K, V> (config: CreateTrackedMapOptions): Map<K, V> {\n  const { system, component, metric, metrics } = config\n  let map: Map<K, V>\n\n  if (metrics != null) {\n    map = new TrackedMap<K, V>({ system, component, metric, metrics })\n  } else {\n    map = new Map<K, V>()\n  }\n\n  return map\n}\n"],"mappings":";;;;;;;IASMA,UAAiB,0BAAAC,IAAA;EAAAC,SAAA,CAAAF,UAAA,EAAAC,IAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAAJ,UAAA;EAMrB,SAAAA,WAAaK,IAAoB;IAAA,IAAAC,KAAA;IAAAC,eAAA,OAAAP,UAAA;IAC/BM,KAAA,GAAAH,MAAA,CAAAK,IAAA;IAEA,IAAQC,MAAM,GAAiCJ,IAAI,CAA3CI,MAAM;MAAEC,SAAS,GAAsBL,IAAI,CAAnCK,SAAS;MAAEC,MAAM,GAAcN,IAAI,CAAxBM,MAAM;MAAEC,OAAO,GAAKP,IAAI,CAAhBO,OAAO;IAC1CN,KAAA,CAAKG,MAAM,GAAGA,MAAM,aAANA,MAAM,cAANA,MAAM,GAAI,QAAQ;IAChCH,KAAA,CAAKI,SAAS,GAAGA,SAAS;IAC1BJ,KAAA,CAAKK,MAAM,GAAGA,MAAM;IACpBL,KAAA,CAAKM,OAAO,GAAGA,OAAO;IAEtBN,KAAA,CAAKO,qBAAqB,EAAE;IAAA,OAAAP,KAAA;EAC9B;EAACQ,YAAA,CAAAd,UAAA;IAAAe,GAAA;IAAAC,KAAA,EAED,SAAAC,IAAKF,GAAM,EAAEC,KAAQ;MACnBE,IAAA,CAAAC,eAAA,CAAAnB,UAAA,CAAAoB,SAAA,gBAAAZ,IAAA,OAAUO,GAAG,EAAEC,KAAK;MACpB,IAAI,CAACH,qBAAqB,EAAE;MAC5B,OAAO,IAAI;IACb;EAAC;IAAAE,GAAA;IAAAC,KAAA,EAED,SAAAK,QAAQN,GAAM;MACZ,IAAMO,OAAO,GAAAJ,IAAA,CAAAC,eAAA,CAAAnB,UAAA,CAAAoB,SAAA,mBAAAZ,IAAA,OAAgBO,GAAG,CAAC;MACjC,IAAI,CAACF,qBAAqB,EAAE;MAC5B,OAAOS,OAAO;IAChB;EAAC;IAAAP,GAAA;IAAAC,KAAA,EAED,SAAAO,MAAA,EAAK;MACHL,IAAA,CAAAC,eAAA,CAAAnB,UAAA,CAAAoB,SAAA,kBAAAZ,IAAA;MACA,IAAI,CAACK,qBAAqB,EAAE;IAC9B;EAAC;IAAAE,GAAA;IAAAC,KAAA,EAEO,SAAAH,sBAAA,EAAqB;MAC3B,IAAI,CAACD,OAAO,CAACC,qBAAqB,CAAC;QACjCJ,MAAM,EAAE,IAAI,CAACA,MAAM;QACnBC,SAAS,EAAE,IAAI,CAACA,SAAS;QACzBC,MAAM,EAAE,IAAI,CAACA,MAAM;QACnBK,KAAK,EAAE,IAAI,CAACQ;OACb,CAAC;IACJ;EAAC;EAAA,OAAAxB,UAAA;AAAA,gBAAAyB,gBAAA,CA1C4BC,GAAS;AAoDxC,OAAM,SAAUC,UAAUA,CAASC,MAA+B;EAChE,IAAQnB,MAAM,GAAiCmB,MAAM,CAA7CnB,MAAM;IAAEC,SAAS,GAAsBkB,MAAM,CAArClB,SAAS;IAAEC,MAAM,GAAciB,MAAM,CAA1BjB,MAAM;IAAEC,OAAO,GAAKgB,MAAM,CAAlBhB,OAAO;EAC1C,IAAIiB,GAAc;EAElB,IAAIjB,OAAO,IAAI,IAAI,EAAE;IACnBiB,GAAG,GAAG,IAAI7B,UAAU,CAAO;MAAES,MAAM,EAANA,MAAM;MAAEC,SAAS,EAATA,SAAS;MAAEC,MAAM,EAANA,MAAM;MAAEC,OAAO,EAAPA;IAAO,CAAE,CAAC;GACnE,MAAM;IACLiB,GAAG,GAAG,IAAIH,GAAG,EAAQ;;EAGvB,OAAOG,GAAG;AACZ"},"metadata":{},"sourceType":"module","externalDependencies":[]}