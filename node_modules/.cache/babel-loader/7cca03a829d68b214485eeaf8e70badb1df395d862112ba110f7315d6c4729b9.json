{"ast":null,"code":"var _classCallCheck = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar RateLimiterAbstract = require('./RateLimiterAbstract');\nmodule.exports = /*#__PURE__*/function () {\n  \"use strict\";\n\n  function RateLimiterUnion() {\n    _classCallCheck(this, RateLimiterUnion);\n    for (var _len = arguments.length, limiters = new Array(_len), _key = 0; _key < _len; _key++) {\n      limiters[_key] = arguments[_key];\n    }\n    if (limiters.length < 1) {\n      throw new Error('RateLimiterUnion: at least one limiter have to be passed');\n    }\n    limiters.forEach(function (limiter) {\n      if (!(limiter instanceof RateLimiterAbstract)) {\n        throw new Error('RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract');\n      }\n    });\n    this._limiters = limiters;\n  }\n  _createClass(RateLimiterUnion, [{\n    key: \"consume\",\n    value: function consume(key) {\n      var _this = this;\n      var points = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n      return new Promise(function (resolve, reject) {\n        var promises = [];\n        _this._limiters.forEach(function (limiter) {\n          promises.push(limiter.consume(key, points).catch(function (rej) {\n            return {\n              rejected: true,\n              rej: rej\n            };\n          }));\n        });\n        Promise.all(promises).then(function (res) {\n          var resObj = {};\n          var rejected = false;\n          res.forEach(function (item) {\n            if (item.rejected === true) {\n              rejected = true;\n            }\n          });\n          for (var i = 0; i < res.length; i++) {\n            if (rejected && res[i].rejected === true) {\n              resObj[_this._limiters[i].keyPrefix] = res[i].rej;\n            } else if (!rejected) {\n              resObj[_this._limiters[i].keyPrefix] = res[i];\n            }\n          }\n          if (rejected) {\n            reject(resObj);\n          } else {\n            resolve(resObj);\n          }\n        });\n      });\n    }\n  }]);\n  return RateLimiterUnion;\n}();","map":{"version":3,"names":["RateLimiterAbstract","require","module","exports","RateLimiterUnion","_classCallCheck","_len","arguments","length","limiters","Array","_key","Error","forEach","limiter","_limiters","_createClass","key","value","consume","_this","points","undefined","Promise","resolve","reject","promises","push","catch","rej","rejected","all","then","res","resObj","item","i","keyPrefix"],"sources":["/Users/apple/Documents/treasure/node_modules/rate-limiter-flexible/lib/RateLimiterUnion.js"],"sourcesContent":["const RateLimiterAbstract = require('./RateLimiterAbstract');\n\nmodule.exports = class RateLimiterUnion {\n  constructor(...limiters) {\n    if (limiters.length < 1) {\n      throw new Error('RateLimiterUnion: at least one limiter have to be passed');\n    }\n    limiters.forEach((limiter) => {\n      if (!(limiter instanceof RateLimiterAbstract)) {\n        throw new Error('RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract');\n      }\n    });\n\n    this._limiters = limiters;\n  }\n\n  consume(key, points = 1) {\n    return new Promise((resolve, reject) => {\n      const promises = [];\n      this._limiters.forEach((limiter) => {\n        promises.push(limiter.consume(key, points).catch(rej => ({ rejected: true, rej })));\n      });\n\n      Promise.all(promises)\n        .then((res) => {\n          const resObj = {};\n          let rejected = false;\n\n          res.forEach((item) => {\n            if (item.rejected === true) {\n              rejected = true;\n            }\n          });\n\n          for (let i = 0; i < res.length; i++) {\n            if (rejected && res[i].rejected === true) {\n              resObj[this._limiters[i].keyPrefix] = res[i].rej;\n            } else if (!rejected) {\n              resObj[this._limiters[i].keyPrefix] = res[i];\n            }\n          }\n\n          if (rejected) {\n            reject(resObj);\n          } else {\n            resolve(resObj);\n          }\n        });\n    });\n  }\n};\n"],"mappings":";;AAAA,IAAMA,mBAAmB,GAAGC,OAAO,CAAC,uBAAuB,CAAC;AAE5DC,MAAM,CAACC,OAAO;EAAA;;EACZ,SAAAC,iBAAA,EAAyB;IAAAC,eAAA,OAAAD,gBAAA;IAAA,SAAAE,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAAVC,QAAQ,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;MAARF,QAAQ,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;IAAA;IACrB,IAAIF,QAAQ,CAACD,MAAM,GAAG,CAAC,EAAE;MACvB,MAAM,IAAII,KAAK,CAAC,0DAA0D,CAAC;IAC7E;IACAH,QAAQ,CAACI,OAAO,CAAC,UAACC,OAAO,EAAK;MAC5B,IAAI,EAAEA,OAAO,YAAYd,mBAAmB,CAAC,EAAE;QAC7C,MAAM,IAAIY,KAAK,CAAC,2EAA2E,CAAC;MAC9F;IACF,CAAC,CAAC;IAEF,IAAI,CAACG,SAAS,GAAGN,QAAQ;EAC3B;EAACO,YAAA,CAAAZ,gBAAA;IAAAa,GAAA;IAAAC,KAAA,EAED,SAAAC,QAAQF,GAAG,EAAc;MAAA,IAAAG,KAAA;MAAA,IAAZC,MAAM,GAAAd,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAe,SAAA,GAAAf,SAAA,MAAG,CAAC;MACrB,OAAO,IAAIgB,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;QACtC,IAAMC,QAAQ,GAAG,EAAE;QACnBN,KAAI,CAACL,SAAS,CAACF,OAAO,CAAC,UAACC,OAAO,EAAK;UAClCY,QAAQ,CAACC,IAAI,CAACb,OAAO,CAACK,OAAO,CAACF,GAAG,EAAEI,MAAM,CAAC,CAACO,KAAK,CAAC,UAAAC,GAAG;YAAA,OAAK;cAAEC,QAAQ,EAAE,IAAI;cAAED,GAAG,EAAHA;YAAI,CAAC;UAAA,CAAC,CAAC,CAAC;QACrF,CAAC,CAAC;QAEFN,OAAO,CAACQ,GAAG,CAACL,QAAQ,CAAC,CAClBM,IAAI,CAAC,UAACC,GAAG,EAAK;UACb,IAAMC,MAAM,GAAG,CAAC,CAAC;UACjB,IAAIJ,QAAQ,GAAG,KAAK;UAEpBG,GAAG,CAACpB,OAAO,CAAC,UAACsB,IAAI,EAAK;YACpB,IAAIA,IAAI,CAACL,QAAQ,KAAK,IAAI,EAAE;cAC1BA,QAAQ,GAAG,IAAI;YACjB;UACF,CAAC,CAAC;UAEF,KAAK,IAAIM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,GAAG,CAACzB,MAAM,EAAE4B,CAAC,EAAE,EAAE;YACnC,IAAIN,QAAQ,IAAIG,GAAG,CAACG,CAAC,CAAC,CAACN,QAAQ,KAAK,IAAI,EAAE;cACxCI,MAAM,CAACd,KAAI,CAACL,SAAS,CAACqB,CAAC,CAAC,CAACC,SAAS,CAAC,GAAGJ,GAAG,CAACG,CAAC,CAAC,CAACP,GAAG;YAClD,CAAC,MAAM,IAAI,CAACC,QAAQ,EAAE;cACpBI,MAAM,CAACd,KAAI,CAACL,SAAS,CAACqB,CAAC,CAAC,CAACC,SAAS,CAAC,GAAGJ,GAAG,CAACG,CAAC,CAAC;YAC9C;UACF;UAEA,IAAIN,QAAQ,EAAE;YACZL,MAAM,CAACS,MAAM,CAAC;UAChB,CAAC,MAAM;YACLV,OAAO,CAACU,MAAM,CAAC;UACjB;QACF,CAAC,CAAC;MACN,CAAC,CAAC;IACJ;EAAC;EAAA,OAAA9B,gBAAA;AAAA,GACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}