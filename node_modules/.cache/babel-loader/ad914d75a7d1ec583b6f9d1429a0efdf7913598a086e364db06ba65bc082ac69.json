{"ast":null,"code":"export default (function (socket) {\n  // if the socket is closing or closed, return end\n  if (socket.readyState >= 2) {\n    throw new Error('socket closed');\n  }\n  // if open, return\n  if (socket.readyState === 1) {\n    return;\n  }\n  return new Promise(function (resolve, reject) {\n    function cleanup() {\n      socket.removeEventListener('open', handleOpen);\n      socket.removeEventListener('error', handleErr);\n    }\n    function handleOpen() {\n      cleanup();\n      resolve();\n    }\n    function handleErr(event) {\n      var _event$error;\n      cleanup();\n      reject((_event$error = event.error) !== null && _event$error !== void 0 ? _event$error : new Error(\"connect ECONNREFUSED \".concat(socket.url)));\n    }\n    socket.addEventListener('open', handleOpen);\n    socket.addEventListener('error', handleErr);\n  });\n});","map":{"version":3,"names":["socket","readyState","Error","Promise","resolve","reject","cleanup","removeEventListener","handleOpen","handleErr","event","_event$error","error","concat","url","addEventListener"],"sources":["/Users/apple/Documents/treasure/node_modules/it-ws/src/ready.ts"],"sourcesContent":["import type { ErrorEvent, WebSocket } from 'ws'\n\nexport default (socket: WebSocket) => {\n  // if the socket is closing or closed, return end\n  if (socket.readyState >= 2) {\n    throw new Error('socket closed')\n  }\n\n  // if open, return\n  if (socket.readyState === 1) {\n    return\n  }\n\n  return new Promise<void>((resolve, reject) => {\n    function cleanup () {\n      socket.removeEventListener('open', handleOpen)\n      socket.removeEventListener('error', handleErr)\n    }\n\n    function handleOpen () {\n      cleanup()\n      resolve()\n    }\n\n    function handleErr (event: ErrorEvent) {\n      cleanup()\n      reject(event.error ?? new Error(`connect ECONNREFUSED ${socket.url}`))\n    }\n\n    socket.addEventListener('open', handleOpen)\n    socket.addEventListener('error', handleErr)\n  })\n}\n"],"mappings":"AAEA,gBAAe,UAACA,MAAiB,EAAI;EACnC;EACA,IAAIA,MAAM,CAACC,UAAU,IAAI,CAAC,EAAE;IAC1B,MAAM,IAAIC,KAAK,CAAC,eAAe,CAAC;;EAGlC;EACA,IAAIF,MAAM,CAACC,UAAU,KAAK,CAAC,EAAE;IAC3B;;EAGF,OAAO,IAAIE,OAAO,CAAO,UAACC,OAAO,EAAEC,MAAM,EAAI;IAC3C,SAASC,OAAOA,CAAA;MACdN,MAAM,CAACO,mBAAmB,CAAC,MAAM,EAAEC,UAAU,CAAC;MAC9CR,MAAM,CAACO,mBAAmB,CAAC,OAAO,EAAEE,SAAS,CAAC;IAChD;IAEA,SAASD,UAAUA,CAAA;MACjBF,OAAO,EAAE;MACTF,OAAO,EAAE;IACX;IAEA,SAASK,SAASA,CAAEC,KAAiB;MAAA,IAAAC,YAAA;MACnCL,OAAO,EAAE;MACTD,MAAM,EAAAM,YAAA,GAACD,KAAK,CAACE,KAAK,cAAAD,YAAA,cAAAA,YAAA,GAAI,IAAIT,KAAK,yBAAAW,MAAA,CAAyBb,MAAM,CAACc,GAAG,CAAE,CAAC,CAAC;IACxE;IAEAd,MAAM,CAACe,gBAAgB,CAAC,MAAM,EAAEP,UAAU,CAAC;IAC3CR,MAAM,CAACe,gBAAgB,CAAC,OAAO,EAAEN,SAAS,CAAC;EAC7C,CAAC,CAAC;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}