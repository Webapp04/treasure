{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _classCallCheck = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/createClass.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar EventQueue = /*#__PURE__*/function (_Symbol$asyncIterator) {\n  function EventQueue() {\n    _classCallCheck(this, EventQueue);\n    this.pullQueue = [];\n    this.pushQueue = [];\n    this.eventHandlers = {};\n    this.isPaused = false;\n    this.isStopped = false;\n  }\n  _createClass(EventQueue, [{\n    key: \"push\",\n    value: function push(value) {\n      if (this.isStopped) return;\n      var resolution = {\n        value: value,\n        done: false\n      };\n      if (this.pullQueue.length) {\n        var placeholder = this.pullQueue.shift();\n        if (placeholder) placeholder.resolve(resolution);\n      } else {\n        this.pushQueue.push(Promise.resolve(resolution));\n        if (this.highWaterMark !== undefined && this.pushQueue.length >= this.highWaterMark && !this.isPaused) {\n          this.isPaused = true;\n          if (this.eventHandlers.highWater) {\n            this.eventHandlers.highWater();\n          } else if (console) {\n            console.warn(\"EventIterator queue reached \".concat(this.pushQueue.length, \" items\"));\n          }\n        }\n      }\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      if (this.isStopped) return;\n      this.isStopped = true;\n      this.remove();\n      var _iterator = _createForOfIteratorHelper(this.pullQueue),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var placeholder = _step.value;\n          placeholder.resolve({\n            value: undefined,\n            done: true\n          });\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      this.pullQueue.length = 0;\n    }\n  }, {\n    key: \"fail\",\n    value: function fail(error) {\n      if (this.isStopped) return;\n      this.isStopped = true;\n      this.remove();\n      if (this.pullQueue.length) {\n        var _iterator2 = _createForOfIteratorHelper(this.pullQueue),\n          _step2;\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var placeholder = _step2.value;\n            placeholder.reject(error);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n        this.pullQueue.length = 0;\n      } else {\n        var rejection = Promise.reject(error);\n        /* Attach error handler to avoid leaking an unhandled promise rejection. */\n        rejection.catch(function () {});\n        this.pushQueue.push(rejection);\n      }\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      var _this = this;\n      Promise.resolve().then(function () {\n        if (_this.removeCallback) _this.removeCallback();\n      });\n    }\n  }, {\n    key: _Symbol$asyncIterator,\n    value: function value() {\n      var _this2 = this;\n      return {\n        next: function next(value) {\n          var result = _this2.pushQueue.shift();\n          if (result) {\n            if (_this2.lowWaterMark !== undefined && _this2.pushQueue.length <= _this2.lowWaterMark && _this2.isPaused) {\n              _this2.isPaused = false;\n              if (_this2.eventHandlers.lowWater) {\n                _this2.eventHandlers.lowWater();\n              }\n            }\n            return result;\n          } else if (_this2.isStopped) {\n            return Promise.resolve({\n              value: undefined,\n              done: true\n            });\n          } else {\n            return new Promise(function (resolve, reject) {\n              _this2.pullQueue.push({\n                resolve: resolve,\n                reject: reject\n              });\n            });\n          }\n        },\n        return: function _return() {\n          _this2.isStopped = true;\n          _this2.pushQueue.length = 0;\n          _this2.remove();\n          return Promise.resolve({\n            value: undefined,\n            done: true\n          });\n        }\n      };\n    }\n  }]);\n  return EventQueue;\n}(Symbol.asyncIterator);\nvar EventIterator = /*#__PURE__*/_createClass(function EventIterator(listen) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    _ref$highWaterMark = _ref.highWaterMark,\n    highWaterMark = _ref$highWaterMark === void 0 ? 100 : _ref$highWaterMark,\n    _ref$lowWaterMark = _ref.lowWaterMark,\n    lowWaterMark = _ref$lowWaterMark === void 0 ? 1 : _ref$lowWaterMark;\n  _classCallCheck(this, EventIterator);\n  var queue = new EventQueue();\n  queue.highWaterMark = highWaterMark;\n  queue.lowWaterMark = lowWaterMark;\n  queue.removeCallback = listen({\n    push: function push(value) {\n      return queue.push(value);\n    },\n    stop: function stop() {\n      return queue.stop();\n    },\n    fail: function fail(error) {\n      return queue.fail(error);\n    },\n    on: function on(event, fn) {\n      queue.eventHandlers[event] = fn;\n    }\n  }) || function () {};\n  this[Symbol.asyncIterator] = function () {\n    return queue[Symbol.asyncIterator]();\n  };\n  Object.freeze(this);\n});\nexports.EventIterator = EventIterator;\nexports.default = EventIterator;","map":{"version":3,"names":["_createForOfIteratorHelper","require","default","_classCallCheck","_createClass","Object","defineProperty","exports","value","EventQueue","_Symbol$asyncIterator","pullQueue","pushQueue","eventHandlers","isPaused","isStopped","key","push","resolution","done","length","placeholder","shift","resolve","Promise","highWaterMark","undefined","highWater","console","warn","concat","stop","remove","_iterator","_step","s","n","err","e","f","fail","error","_iterator2","_step2","reject","rejection","catch","_this","then","removeCallback","_this2","next","result","lowWaterMark","lowWater","return","_return","Symbol","asyncIterator","EventIterator","listen","_ref","arguments","_ref$highWaterMark","_ref$lowWaterMark","queue","on","event","fn","freeze"],"sources":["/Users/apple/Documents/treasure/node_modules/event-iterator/lib/event-iterator.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass EventQueue {\n    constructor() {\n        this.pullQueue = [];\n        this.pushQueue = [];\n        this.eventHandlers = {};\n        this.isPaused = false;\n        this.isStopped = false;\n    }\n    push(value) {\n        if (this.isStopped)\n            return;\n        const resolution = { value, done: false };\n        if (this.pullQueue.length) {\n            const placeholder = this.pullQueue.shift();\n            if (placeholder)\n                placeholder.resolve(resolution);\n        }\n        else {\n            this.pushQueue.push(Promise.resolve(resolution));\n            if (this.highWaterMark !== undefined &&\n                this.pushQueue.length >= this.highWaterMark &&\n                !this.isPaused) {\n                this.isPaused = true;\n                if (this.eventHandlers.highWater) {\n                    this.eventHandlers.highWater();\n                }\n                else if (console) {\n                    console.warn(`EventIterator queue reached ${this.pushQueue.length} items`);\n                }\n            }\n        }\n    }\n    stop() {\n        if (this.isStopped)\n            return;\n        this.isStopped = true;\n        this.remove();\n        for (const placeholder of this.pullQueue) {\n            placeholder.resolve({ value: undefined, done: true });\n        }\n        this.pullQueue.length = 0;\n    }\n    fail(error) {\n        if (this.isStopped)\n            return;\n        this.isStopped = true;\n        this.remove();\n        if (this.pullQueue.length) {\n            for (const placeholder of this.pullQueue) {\n                placeholder.reject(error);\n            }\n            this.pullQueue.length = 0;\n        }\n        else {\n            const rejection = Promise.reject(error);\n            /* Attach error handler to avoid leaking an unhandled promise rejection. */\n            rejection.catch(() => { });\n            this.pushQueue.push(rejection);\n        }\n    }\n    remove() {\n        Promise.resolve().then(() => {\n            if (this.removeCallback)\n                this.removeCallback();\n        });\n    }\n    [Symbol.asyncIterator]() {\n        return {\n            next: (value) => {\n                const result = this.pushQueue.shift();\n                if (result) {\n                    if (this.lowWaterMark !== undefined &&\n                        this.pushQueue.length <= this.lowWaterMark &&\n                        this.isPaused) {\n                        this.isPaused = false;\n                        if (this.eventHandlers.lowWater) {\n                            this.eventHandlers.lowWater();\n                        }\n                    }\n                    return result;\n                }\n                else if (this.isStopped) {\n                    return Promise.resolve({ value: undefined, done: true });\n                }\n                else {\n                    return new Promise((resolve, reject) => {\n                        this.pullQueue.push({ resolve, reject });\n                    });\n                }\n            },\n            return: () => {\n                this.isStopped = true;\n                this.pushQueue.length = 0;\n                this.remove();\n                return Promise.resolve({ value: undefined, done: true });\n            },\n        };\n    }\n}\nclass EventIterator {\n    constructor(listen, { highWaterMark = 100, lowWaterMark = 1 } = {}) {\n        const queue = new EventQueue();\n        queue.highWaterMark = highWaterMark;\n        queue.lowWaterMark = lowWaterMark;\n        queue.removeCallback =\n            listen({\n                push: value => queue.push(value),\n                stop: () => queue.stop(),\n                fail: error => queue.fail(error),\n                on: (event, fn) => {\n                    queue.eventHandlers[event] = fn;\n                },\n            }) || (() => { });\n        this[Symbol.asyncIterator] = () => queue[Symbol.asyncIterator]();\n        Object.freeze(this);\n    }\n}\nexports.EventIterator = EventIterator;\nexports.default = EventIterator;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}