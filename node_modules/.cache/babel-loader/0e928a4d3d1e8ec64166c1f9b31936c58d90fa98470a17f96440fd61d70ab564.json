{"ast":null,"code":"import _regeneratorRuntime from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _wrapAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js\";\nimport _awaitAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js\";\nimport _asyncGeneratorDelegate from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncGeneratorDelegate.js\";\nimport _asyncIterator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";\nimport drain from 'it-drain';\nimport errCode from 'err-code';\n/**\n * Wrapper class to convert events into returned values\n */\nexport var DHTContentRouting = /*#__PURE__*/function () {\n  function DHTContentRouting(dht) {\n    _classCallCheck(this, DHTContentRouting);\n    this.dht = dht;\n  }\n  _createClass(DHTContentRouting, [{\n    key: \"provide\",\n    value: function () {\n      var _provide = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(cid) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return drain(this.dht.provide(cid));\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function provide(_x) {\n        return _provide.apply(this, arguments);\n      }\n      return provide;\n    }()\n  }, {\n    key: \"findProviders\",\n    value: function findProviders(cid) {\n      var _this = this;\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, event;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _iteratorAbruptCompletion = false;\n              _didIteratorError = false;\n              _context2.prev = 2;\n              _iterator = _asyncIterator(_this.dht.findProviders(cid, options));\n            case 4:\n              _context2.next = 6;\n              return _awaitAsyncGenerator(_iterator.next());\n            case 6:\n              if (!(_iteratorAbruptCompletion = !(_step = _context2.sent).done)) {\n                _context2.next = 13;\n                break;\n              }\n              event = _step.value;\n              if (!(event.name === 'PROVIDER')) {\n                _context2.next = 10;\n                break;\n              }\n              return _context2.delegateYield(_asyncGeneratorDelegate(_asyncIterator(event.providers), _awaitAsyncGenerator), \"t0\", 10);\n            case 10:\n              _iteratorAbruptCompletion = false;\n              _context2.next = 4;\n              break;\n            case 13:\n              _context2.next = 19;\n              break;\n            case 15:\n              _context2.prev = 15;\n              _context2.t1 = _context2[\"catch\"](2);\n              _didIteratorError = true;\n              _iteratorError = _context2.t1;\n            case 19:\n              _context2.prev = 19;\n              _context2.prev = 20;\n              if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n                _context2.next = 24;\n                break;\n              }\n              _context2.next = 24;\n              return _awaitAsyncGenerator(_iterator.return());\n            case 24:\n              _context2.prev = 24;\n              if (!_didIteratorError) {\n                _context2.next = 27;\n                break;\n              }\n              throw _iteratorError;\n            case 27:\n              return _context2.finish(24);\n            case 28:\n              return _context2.finish(19);\n            case 29:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 15, 19, 29], [20,, 24, 28]]);\n      }))();\n    }\n  }, {\n    key: \"put\",\n    value: function () {\n      var _put = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(key, value, options) {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return drain(this.dht.put(key, value, options));\n            case 2:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function put(_x2, _x3, _x4) {\n        return _put.apply(this, arguments);\n      }\n      return put;\n    }()\n  }, {\n    key: \"get\",\n    value: function () {\n      var _get = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(key, options) {\n        var _iteratorAbruptCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, event;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _iteratorAbruptCompletion2 = false;\n              _didIteratorError2 = false;\n              _context4.prev = 2;\n              _iterator2 = _asyncIterator(this.dht.get(key, options));\n            case 4:\n              _context4.next = 6;\n              return _iterator2.next();\n            case 6:\n              if (!(_iteratorAbruptCompletion2 = !(_step2 = _context4.sent).done)) {\n                _context4.next = 13;\n                break;\n              }\n              event = _step2.value;\n              if (!(event.name === 'VALUE')) {\n                _context4.next = 10;\n                break;\n              }\n              return _context4.abrupt(\"return\", event.value);\n            case 10:\n              _iteratorAbruptCompletion2 = false;\n              _context4.next = 4;\n              break;\n            case 13:\n              _context4.next = 19;\n              break;\n            case 15:\n              _context4.prev = 15;\n              _context4.t0 = _context4[\"catch\"](2);\n              _didIteratorError2 = true;\n              _iteratorError2 = _context4.t0;\n            case 19:\n              _context4.prev = 19;\n              _context4.prev = 20;\n              if (!(_iteratorAbruptCompletion2 && _iterator2.return != null)) {\n                _context4.next = 24;\n                break;\n              }\n              _context4.next = 24;\n              return _iterator2.return();\n            case 24:\n              _context4.prev = 24;\n              if (!_didIteratorError2) {\n                _context4.next = 27;\n                break;\n              }\n              throw _iteratorError2;\n            case 27:\n              return _context4.finish(24);\n            case 28:\n              return _context4.finish(19);\n            case 29:\n              throw errCode(new Error('Not found'), 'ERR_NOT_FOUND');\n            case 30:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[2, 15, 19, 29], [20,, 24, 28]]);\n      }));\n      function get(_x5, _x6) {\n        return _get.apply(this, arguments);\n      }\n      return get;\n    }()\n  }]);\n  return DHTContentRouting;\n}();","map":{"version":3,"names":["drain","errCode","DHTContentRouting","dht","_classCallCheck","_createClass","key","value","_provide","_asyncToGenerator","_regeneratorRuntime","mark","_callee","cid","wrap","_callee$","_context","prev","next","provide","stop","_x","apply","arguments","findProviders","_this","options","length","undefined","_wrapAsyncGenerator","_callee2","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","event","_callee2$","_context2","_asyncIterator","_awaitAsyncGenerator","sent","done","name","delegateYield","_asyncGeneratorDelegate","providers","t1","return","finish","_put","_callee3","_callee3$","_context3","put","_x2","_x3","_x4","_get","_callee4","_iteratorAbruptCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_callee4$","_context4","get","abrupt","t0","Error","_x5","_x6"],"sources":["/Users/apple/Documents/treasure/node_modules/libp2p/src/dht/dht-content-routing.ts"],"sourcesContent":["import drain from 'it-drain'\nimport errCode from 'err-code'\nimport type { DHT } from '@libp2p/interface-dht'\nimport type { ContentRouting } from '@libp2p/interface-content-routing'\nimport type { CID } from 'multiformats/cid'\nimport type { AbortOptions } from '@libp2p/interfaces'\n\n/**\n * Wrapper class to convert events into returned values\n */\nexport class DHTContentRouting implements ContentRouting {\n  private readonly dht: DHT\n\n  constructor (dht: DHT) {\n    this.dht = dht\n  }\n\n  async provide (cid: CID) {\n    await drain(this.dht.provide(cid))\n  }\n\n  async * findProviders (cid: CID, options: AbortOptions = {}) {\n    for await (const event of this.dht.findProviders(cid, options)) {\n      if (event.name === 'PROVIDER') {\n        yield * event.providers\n      }\n    }\n  }\n\n  async put (key: Uint8Array, value: Uint8Array, options?: AbortOptions): Promise<void> {\n    await drain(this.dht.put(key, value, options))\n  }\n\n  async get (key: Uint8Array, options?: AbortOptions): Promise<Uint8Array> {\n    for await (const event of this.dht.get(key, options)) {\n      if (event.name === 'VALUE') {\n        return event.value\n      }\n    }\n\n    throw errCode(new Error('Not found'), 'ERR_NOT_FOUND')\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}