{"ast":null,"code":"import _classCallCheck from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { abortableSource } from 'abortable-iterator';\nimport { pipe } from 'it-pipe';\nimport { pushable } from 'it-pushable';\nimport { encode, decode } from 'it-length-prefixed';\nexport var OutboundStream = /*#__PURE__*/function () {\n  function OutboundStream(rawStream, errCallback, opts) {\n    var _opts$maxBufferSize;\n    _classCallCheck(this, OutboundStream);\n    this.rawStream = rawStream;\n    this.pushable = pushable({\n      objectMode: false\n    });\n    this.closeController = new AbortController();\n    this.maxBufferSize = (_opts$maxBufferSize = opts.maxBufferSize) !== null && _opts$maxBufferSize !== void 0 ? _opts$maxBufferSize : Infinity;\n    pipe(abortableSource(this.pushable, this.closeController.signal, {\n      returnOnAbort: true\n    }), encode(), this.rawStream).catch(errCallback);\n  }\n  _createClass(OutboundStream, [{\n    key: \"protocol\",\n    get: function get() {\n      // TODO remove this non-nullish assertion after https://github.com/libp2p/js-libp2p-interfaces/pull/265 is incorporated\n      return this.rawStream.stat.protocol;\n    }\n  }, {\n    key: \"push\",\n    value: function push(data) {\n      if (this.pushable.readableLength > this.maxBufferSize) {\n        throw Error(\"OutboundStream buffer full, size > \".concat(this.maxBufferSize));\n      }\n      this.pushable.push(data);\n    }\n  }, {\n    key: \"close\",\n    value: function close() {\n      this.closeController.abort();\n      // similar to pushable.end() but clear the internal buffer\n      this.pushable.return();\n      this.rawStream.close();\n    }\n  }]);\n  return OutboundStream;\n}();\nexport var InboundStream = /*#__PURE__*/function () {\n  function InboundStream(rawStream) {\n    _classCallCheck(this, InboundStream);\n    this.rawStream = rawStream;\n    this.closeController = new AbortController();\n    this.source = abortableSource(pipe(this.rawStream, decode()), this.closeController.signal, {\n      returnOnAbort: true\n    });\n  }\n  _createClass(InboundStream, [{\n    key: \"close\",\n    value: function close() {\n      this.closeController.abort();\n      this.rawStream.close();\n    }\n  }]);\n  return InboundStream;\n}();","map":{"version":3,"names":["abortableSource","pipe","pushable","encode","decode","OutboundStream","rawStream","errCallback","opts","_opts$maxBufferSize","_classCallCheck","objectMode","closeController","AbortController","maxBufferSize","Infinity","signal","returnOnAbort","catch","_createClass","key","get","stat","protocol","value","push","data","readableLength","Error","concat","close","abort","return","InboundStream","source"],"sources":["../../src/stream.ts"],"sourcesContent":[null],"mappings":";;AACA,SAASA,eAAe,QAAQ,oBAAoB;AACpD,SAASC,IAAI,QAAQ,SAAS;AAC9B,SAASC,QAAQ,QAAkB,aAAa;AAChD,SAASC,MAAM,EAAEC,MAAM,QAAQ,oBAAoB;AAQnD,WAAaC,cAAc;EAKzB,SAAAA,eAA6BC,SAAiB,EAAEC,WAA+B,EAAEC,IAAwB;IAAA,IAAAC,mBAAA;IAAAC,eAAA,OAAAL,cAAA;IAA5E,KAAAC,SAAS,GAATA,SAAS;IACpC,IAAI,CAACJ,QAAQ,GAAGA,QAAQ,CAAC;MAAES,UAAU,EAAE;IAAK,CAAE,CAAC;IAC/C,IAAI,CAACC,eAAe,GAAG,IAAIC,eAAe,EAAE;IAC5C,IAAI,CAACC,aAAa,IAAAL,mBAAA,GAAGD,IAAI,CAACM,aAAa,cAAAL,mBAAA,cAAAA,mBAAA,GAAIM,QAAQ;IAEnDd,IAAI,CACFD,eAAe,CAAC,IAAI,CAACE,QAAQ,EAAE,IAAI,CAACU,eAAe,CAACI,MAAM,EAAE;MAAEC,aAAa,EAAE;IAAI,CAAE,CAAC,EACpFd,MAAM,EAAE,EACR,IAAI,CAACG,SAAS,CACf,CAACY,KAAK,CAACX,WAAW,CAAC;EACtB;EAACY,YAAA,CAAAd,cAAA;IAAAe,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAY;MACV;MACA,OAAO,IAAI,CAACf,SAAS,CAACgB,IAAI,CAACC,QAAS;IACtC;EAAC;IAAAH,GAAA;IAAAI,KAAA,EAED,SAAAC,KAAKC,IAAgB;MACnB,IAAI,IAAI,CAACxB,QAAQ,CAACyB,cAAc,GAAG,IAAI,CAACb,aAAa,EAAE;QACrD,MAAMc,KAAK,uCAAAC,MAAA,CAAuC,IAAI,CAACf,aAAa,CAAE,CAAC;;MAGzE,IAAI,CAACZ,QAAQ,CAACuB,IAAI,CAACC,IAAI,CAAC;IAC1B;EAAC;IAAAN,GAAA;IAAAI,KAAA,EAED,SAAAM,MAAA,EAAK;MACH,IAAI,CAAClB,eAAe,CAACmB,KAAK,EAAE;MAC5B;MACA,IAAI,CAAC7B,QAAQ,CAAC8B,MAAM,EAAE;MACtB,IAAI,CAAC1B,SAAS,CAACwB,KAAK,EAAE;IACxB;EAAC;EAAA,OAAAzB,cAAA;AAAA;AAGH,WAAa4B,aAAa;EAMxB,SAAAA,cAAY3B,SAAiB;IAAAI,eAAA,OAAAuB,aAAA;IAC3B,IAAI,CAAC3B,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACM,eAAe,GAAG,IAAIC,eAAe,EAAE;IAE5C,IAAI,CAACqB,MAAM,GAAGlC,eAAe,CAACC,IAAI,CAAC,IAAI,CAACK,SAAS,EAAEF,MAAM,EAAE,CAAC,EAAE,IAAI,CAACQ,eAAe,CAACI,MAAM,EAAE;MAAEC,aAAa,EAAE;IAAI,CAAE,CAAC;EACrH;EAACE,YAAA,CAAAc,aAAA;IAAAb,GAAA;IAAAI,KAAA,EAED,SAAAM,MAAA,EAAK;MACH,IAAI,CAAClB,eAAe,CAACmB,KAAK,EAAE;MAC5B,IAAI,CAACzB,SAAS,CAACwB,KAAK,EAAE;IACxB;EAAC;EAAA,OAAAG,aAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}