{"ast":null,"code":"import _slicedToArray from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _wrapAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js\";\nimport _awaitAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js\";\nimport _asyncGeneratorDelegate from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncGeneratorDelegate.js\";\nimport _asyncIterator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";\nimport { BaseBlockstore } from './base.js';\nimport { base32 } from 'multiformats/bases/base32';\nimport * as raw from 'multiformats/codecs/raw';\nimport { CID } from 'multiformats/cid';\nimport * as Digest from 'multiformats/hashes/digest';\nimport * as Errors from './errors.js';\n\n/**\n * @typedef {import('interface-blockstore').Pair} Pair\n * @typedef {import('interface-blockstore').Blockstore} Blockstore\n * @typedef {import('interface-store').Options} Options\n */\n\n/**\n * @class MemoryBlockstore\n * @implements {Blockstore}\n */\nexport var MemoryBlockstore = /*#__PURE__*/function (_BaseBlockstore) {\n  _inherits(MemoryBlockstore, _BaseBlockstore);\n  var _super = _createSuper(MemoryBlockstore);\n  function MemoryBlockstore() {\n    var _this3;\n    _classCallCheck(this, MemoryBlockstore);\n    _this3 = _super.call(this);\n\n    /** @type {Record<string, Uint8Array>} */\n    _this3.data = {};\n    return _this3;\n  }\n  _createClass(MemoryBlockstore, [{\n    key: \"open\",\n    value: function open() {\n      return Promise.resolve();\n    }\n  }, {\n    key: \"close\",\n    value: function close() {\n      return Promise.resolve();\n    }\n\n    /**\n     * @param {CID} key\n     * @param {Uint8Array} val\n     */\n  }, {\n    key: \"put\",\n    value: function () {\n      var _put = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(key, val) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              // eslint-disable-line require-await\n              this.data[base32.encode(key.multihash.bytes)] = val;\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function put(_x, _x2) {\n        return _put.apply(this, arguments);\n      }\n      return put;\n    }()\n    /**\n     * @param {CID} key\n     */\n  }, {\n    key: \"get\",\n    value: function () {\n      var _get = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(key) {\n        var exists;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return this.has(key);\n            case 2:\n              exists = _context2.sent;\n              if (exists) {\n                _context2.next = 5;\n                break;\n              }\n              throw Errors.notFoundError();\n            case 5:\n              return _context2.abrupt(\"return\", this.data[base32.encode(key.multihash.bytes)]);\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function get(_x3) {\n        return _get.apply(this, arguments);\n      }\n      return get;\n    }()\n    /**\n     * @param {CID} key\n     */\n  }, {\n    key: \"has\",\n    value: function () {\n      var _has = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(key) {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              return _context3.abrupt(\"return\", this.data[base32.encode(key.multihash.bytes)] !== undefined);\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function has(_x4) {\n        return _has.apply(this, arguments);\n      }\n      return has;\n    }()\n    /**\n     * @param {CID} key\n     */\n  }, {\n    key: \"delete\",\n    value: function () {\n      var _delete2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(key) {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              // eslint-disable-line require-await\n              delete this.data[base32.encode(key.multihash.bytes)];\n            case 1:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function _delete(_x5) {\n        return _delete2.apply(this, arguments);\n      }\n      return _delete;\n    }()\n  }, {\n    key: \"_all\",\n    value: function _all() {\n      var _this = this;\n      return _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              return _context5.delegateYield(_asyncGeneratorDelegate(_asyncIterator(Object.entries(_this.data).map(function (_ref) {\n                var _ref2 = _slicedToArray(_ref, 2),\n                  key = _ref2[0],\n                  value = _ref2[1];\n                return {\n                  key: CID.createV1(raw.code, Digest.decode(base32.decode(key))),\n                  value: value\n                };\n              })), _awaitAsyncGenerator), \"t0\", 1);\n            case 1:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5);\n      }))();\n    }\n  }, {\n    key: \"_allKeys\",\n    value: function _allKeys() {\n      var _this2 = this;\n      return _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              return _context6.delegateYield(_asyncGeneratorDelegate(_asyncIterator(Object.entries(_this2.data).map(function (_ref3) {\n                var _ref4 = _slicedToArray(_ref3, 1),\n                  key = _ref4[0];\n                return CID.createV1(raw.code, Digest.decode(base32.decode(key)));\n              })), _awaitAsyncGenerator), \"t0\", 1);\n            case 1:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6);\n      }))();\n    }\n  }]);\n  return MemoryBlockstore;\n}(BaseBlockstore);","map":{"version":3,"names":["BaseBlockstore","base32","raw","CID","Digest","Errors","MemoryBlockstore","_BaseBlockstore","_inherits","_super","_createSuper","_this3","_classCallCheck","call","data","_createClass","key","value","open","Promise","resolve","close","_put","_asyncToGenerator","_regeneratorRuntime","mark","_callee","val","wrap","_callee$","_context","prev","next","encode","multihash","bytes","stop","put","_x","_x2","apply","arguments","_get","_callee2","exists","_callee2$","_context2","has","sent","notFoundError","abrupt","get","_x3","_has","_callee3","_callee3$","_context3","undefined","_x4","_delete2","_callee4","_callee4$","_context4","_delete","_x5","_all","_this","_wrapAsyncGenerator","_callee5","_callee5$","_context5","delegateYield","_asyncGeneratorDelegate","_asyncIterator","Object","entries","map","_ref","_ref2","_slicedToArray","createV1","code","decode","_awaitAsyncGenerator","_allKeys","_this2","_callee6","_callee6$","_context6","_ref3","_ref4"],"sources":["/Users/apple/Documents/treasure/node_modules/blockstore-core/src/memory.js"],"sourcesContent":["import { BaseBlockstore } from './base.js'\nimport { base32 } from 'multiformats/bases/base32'\nimport * as raw from 'multiformats/codecs/raw'\nimport { CID } from 'multiformats/cid'\nimport * as Digest from 'multiformats/hashes/digest'\nimport * as Errors from './errors.js'\n\n/**\n * @typedef {import('interface-blockstore').Pair} Pair\n * @typedef {import('interface-blockstore').Blockstore} Blockstore\n * @typedef {import('interface-store').Options} Options\n */\n\n/**\n * @class MemoryBlockstore\n * @implements {Blockstore}\n */\nexport class MemoryBlockstore extends BaseBlockstore {\n  constructor () {\n    super()\n\n    /** @type {Record<string, Uint8Array>} */\n    this.data = {}\n  }\n\n  open () {\n    return Promise.resolve()\n  }\n\n  close () {\n    return Promise.resolve()\n  }\n\n  /**\n   * @param {CID} key\n   * @param {Uint8Array} val\n   */\n  async put (key, val) { // eslint-disable-line require-await\n    this.data[base32.encode(key.multihash.bytes)] = val\n  }\n\n  /**\n   * @param {CID} key\n   */\n  async get (key) {\n    const exists = await this.has(key)\n    if (!exists) throw Errors.notFoundError()\n    return this.data[base32.encode(key.multihash.bytes)]\n  }\n\n  /**\n   * @param {CID} key\n   */\n  async has (key) { // eslint-disable-line require-await\n    return this.data[base32.encode(key.multihash.bytes)] !== undefined\n  }\n\n  /**\n   * @param {CID} key\n   */\n  async delete (key) { // eslint-disable-line require-await\n    delete this.data[base32.encode(key.multihash.bytes)]\n  }\n\n  async * _all () {\n    yield * Object.entries(this.data)\n      .map(([key, value]) => ({ key: CID.createV1(raw.code, Digest.decode(base32.decode(key))), value }))\n  }\n\n  async * _allKeys () {\n    yield * Object.entries(this.data)\n      .map(([key]) => CID.createV1(raw.code, Digest.decode(base32.decode(key))))\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}