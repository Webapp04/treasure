{"ast":null,"code":"import { fromString as uint8ArrayFromString } from 'uint8arrays/from-string';\nvar ZEROS = '0000000000000000000';\nvar SEVENS = '7777777777777777777';\nvar ZERO_OFFSET = '0'.charCodeAt(0);\nvar USTAR_MAGIC = uint8ArrayFromString('ustar\\x00', 'binary');\nvar USTAR_VER = uint8ArrayFromString('00', 'binary');\nvar MASK = parseInt('7777', 8);\nvar MAGIC_OFFSET = 257;\nvar VERSION_OFFSET = 263;\nvar toTypeflag = function toTypeflag(flag) {\n  switch (flag) {\n    case 'file':\n      return 0;\n    case 'link':\n      return 1;\n    case 'symlink':\n      return 2;\n    case 'character-device':\n      return 3;\n    case 'block-device':\n      return 4;\n    case 'directory':\n      return 5;\n    case 'fifo':\n      return 6;\n    case 'contiguous-file':\n      return 7;\n    case 'pax-header':\n      return 72;\n    default:\n      return 0;\n  }\n};\nvar cksum = function cksum(block) {\n  var sum = 8 * 32;\n  for (var i = 0; i < 148; i++) sum += block[i];\n  for (var j = 156; j < 512; j++) sum += block[j];\n  return sum;\n};\nvar encodeOct = function encodeOct(val, n) {\n  var str = val.toString(8);\n  if (str.length > n) {\n    return uint8ArrayFromString(SEVENS.slice(0, n) + ' ');\n  }\n  return uint8ArrayFromString(ZEROS.slice(0, n - str.length) + str + ' ');\n};\nvar addLength = function addLength(str) {\n  var len = uint8ArrayFromString(str).byteLength;\n  var digits = Math.floor(Math.log(len) / Math.log(10)) + 1;\n  if (len + digits >= Math.pow(10, digits)) {\n    digits++;\n  }\n  return \"\".concat(len + digits).concat(str);\n};\nexport function encodePax(opts) {\n  var result = '';\n  if (opts.name != null) {\n    result += addLength(' path=' + opts.name + '\\n');\n  }\n  if (opts.linkname != null) {\n    result += addLength(' linkpath=' + opts.linkname + '\\n');\n  }\n  var pax = opts.pax;\n  if (pax != null) {\n    for (var key in pax) {\n      if (Object.prototype.hasOwnProperty.call(pax, key)) {\n        result += addLength(' ' + key + '=' + pax[key] + '\\n');\n      }\n    }\n  }\n  return uint8ArrayFromString(result);\n}\nexport function encode(opts) {\n  var _opts$devmajor, _opts$devminor;\n  var buf = new Uint8Array(512);\n  var name = opts.name;\n  var prefix = '';\n  if (opts.typeflag === 5 && name[name.length - 1] !== '/') {\n    name += '/';\n  }\n  if (uint8ArrayFromString(name).byteLength !== name.length) {\n    return null; // utf-8\n  }\n\n  while (uint8ArrayFromString(name).byteLength > 100) {\n    var i = name.indexOf('/');\n    if (i === -1) {\n      return null;\n    }\n    prefix += prefix !== '' ? '/' + name.slice(0, i) : name.slice(0, i);\n    name = name.slice(i + 1);\n  }\n  if (uint8ArrayFromString(name).byteLength > 100 || uint8ArrayFromString(prefix).byteLength > 155) {\n    return null;\n  }\n  if (opts.linkname != null && uint8ArrayFromString(opts.linkname).byteLength > 100) {\n    return null;\n  }\n  buf.set(uint8ArrayFromString(name), 0);\n  buf.set(encodeOct(opts.mode & MASK, 6), 100);\n  buf.set(encodeOct(opts.uid, 6), 108);\n  buf.set(encodeOct(opts.gid, 6), 116);\n  buf.set(encodeOct(opts.size, 11), 124);\n  buf.set(encodeOct(opts.mtime.getTime() / 1000 | 0, 11), 136);\n  buf[156] = ZERO_OFFSET + toTypeflag(opts.type);\n  if (opts.linkname != null) {\n    buf.set(uint8ArrayFromString(opts.linkname), 157);\n  }\n  buf.set(USTAR_MAGIC, MAGIC_OFFSET);\n  buf.set(USTAR_VER, VERSION_OFFSET);\n  if (opts.uname != null) {\n    buf.set(uint8ArrayFromString(opts.uname), 265);\n  }\n  if (opts.gname != null) {\n    buf.set(uint8ArrayFromString(opts.gname), 297);\n  }\n  buf.set(encodeOct((_opts$devmajor = opts.devmajor) !== null && _opts$devmajor !== void 0 ? _opts$devmajor : 0, 6), 329);\n  buf.set(encodeOct((_opts$devminor = opts.devminor) !== null && _opts$devminor !== void 0 ? _opts$devminor : 0, 6), 337);\n  if (prefix != null) {\n    buf.set(uint8ArrayFromString(prefix), 345);\n  }\n  buf.set(encodeOct(cksum(buf), 6), 148);\n  return buf;\n}","map":{"version":3,"names":["fromString","uint8ArrayFromString","ZEROS","SEVENS","ZERO_OFFSET","charCodeAt","USTAR_MAGIC","USTAR_VER","MASK","parseInt","MAGIC_OFFSET","VERSION_OFFSET","toTypeflag","flag","cksum","block","sum","i","j","encodeOct","val","n","str","toString","length","slice","addLength","len","byteLength","digits","Math","floor","log","pow","concat","encodePax","opts","result","name","linkname","pax","key","Object","prototype","hasOwnProperty","call","encode","_opts$devmajor","_opts$devminor","buf","Uint8Array","prefix","typeflag","indexOf","set","mode","uid","gid","size","mtime","getTime","type","uname","gname","devmajor","devminor"],"sources":["/Users/apple/Documents/treasure/node_modules/it-tar/src/pack-headers.ts"],"sourcesContent":["import { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport type { EntryType, TarEntryHeader } from '.'\n\nconst ZEROS = '0000000000000000000'\nconst SEVENS = '7777777777777777777'\nconst ZERO_OFFSET = '0'.charCodeAt(0)\nconst USTAR_MAGIC = uint8ArrayFromString('ustar\\x00', 'binary')\nconst USTAR_VER = uint8ArrayFromString('00', 'binary')\nconst MASK = parseInt('7777', 8)\nconst MAGIC_OFFSET = 257\nconst VERSION_OFFSET = 263\n\nconst toTypeflag = function (flag?: EntryType) {\n  switch (flag) {\n    case 'file':\n      return 0\n    case 'link':\n      return 1\n    case 'symlink':\n      return 2\n    case 'character-device':\n      return 3\n    case 'block-device':\n      return 4\n    case 'directory':\n      return 5\n    case 'fifo':\n      return 6\n    case 'contiguous-file':\n      return 7\n    case 'pax-header':\n      return 72\n    default:\n      return 0\n  }\n}\n\nconst cksum = function (block: Uint8Array) {\n  let sum = 8 * 32\n  for (let i = 0; i < 148; i++) sum += block[i]\n  for (let j = 156; j < 512; j++) sum += block[j]\n  return sum\n}\n\nconst encodeOct = function (val: number, n: number): Uint8Array {\n  const str = val.toString(8)\n\n  if (str.length > n) {\n    return uint8ArrayFromString(SEVENS.slice(0, n) + ' ')\n  }\n\n  return uint8ArrayFromString(ZEROS.slice(0, n - str.length) + str + ' ')\n}\n\nconst addLength = function (str: string) {\n  const len = uint8ArrayFromString(str).byteLength\n  let digits = Math.floor(Math.log(len) / Math.log(10)) + 1\n\n  if (len + digits >= Math.pow(10, digits)) {\n    digits++\n  }\n\n  return `${len + digits}${str}`\n}\n\nexport function encodePax (opts: TarEntryHeader) { // TODO: encode more stuff in pax\n  let result = ''\n  if (opts.name != null) {\n    result += addLength(' path=' + opts.name + '\\n')\n  }\n  if (opts.linkname != null) {\n    result += addLength(' linkpath=' + opts.linkname + '\\n')\n  }\n\n  const pax = opts.pax\n\n  if (pax != null) {\n    for (const key in pax) {\n      if (Object.prototype.hasOwnProperty.call(pax, key)) {\n        result += addLength(' ' + key + '=' + pax[key] + '\\n')\n      }\n    }\n  }\n\n  return uint8ArrayFromString(result)\n}\n\nexport function encode (opts: TarEntryHeader): Uint8Array | null {\n  const buf = new Uint8Array(512)\n  let name = opts.name\n  let prefix = ''\n\n  if (opts.typeflag === 5 && name[name.length - 1] !== '/') {\n    name += '/'\n  }\n\n  if (uint8ArrayFromString(name).byteLength !== name.length) {\n    return null // utf-8\n  }\n\n  while (uint8ArrayFromString(name).byteLength > 100) {\n    const i = name.indexOf('/')\n    if (i === -1) {\n      return null\n    }\n    prefix += prefix !== '' ? '/' + name.slice(0, i) : name.slice(0, i)\n    name = name.slice(i + 1)\n  }\n\n  if (uint8ArrayFromString(name).byteLength > 100 || uint8ArrayFromString(prefix).byteLength > 155) {\n    return null\n  }\n\n  if (opts.linkname != null && uint8ArrayFromString(opts.linkname).byteLength > 100) {\n    return null\n  }\n\n  buf.set(uint8ArrayFromString(name), 0)\n  buf.set(encodeOct(opts.mode & MASK, 6), 100)\n  buf.set(encodeOct(opts.uid, 6), 108)\n  buf.set(encodeOct(opts.gid, 6), 116)\n  buf.set(encodeOct(opts.size, 11), 124)\n  buf.set(encodeOct((opts.mtime.getTime() / 1000) | 0, 11), 136)\n\n  buf[156] = ZERO_OFFSET + toTypeflag(opts.type)\n\n  if (opts.linkname != null) {\n    buf.set(uint8ArrayFromString(opts.linkname), 157)\n  }\n\n  buf.set(USTAR_MAGIC, MAGIC_OFFSET)\n  buf.set(USTAR_VER, VERSION_OFFSET)\n\n  if (opts.uname != null) {\n    buf.set(uint8ArrayFromString(opts.uname), 265)\n  }\n\n  if (opts.gname != null) {\n    buf.set(uint8ArrayFromString(opts.gname), 297)\n  }\n\n  buf.set(encodeOct(opts.devmajor ?? 0, 6), 329)\n  buf.set(encodeOct(opts.devminor ?? 0, 6), 337)\n\n  if (prefix != null) {\n    buf.set(uint8ArrayFromString(prefix), 345)\n  }\n\n  buf.set(encodeOct(cksum(buf), 6), 148)\n\n  return buf\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}