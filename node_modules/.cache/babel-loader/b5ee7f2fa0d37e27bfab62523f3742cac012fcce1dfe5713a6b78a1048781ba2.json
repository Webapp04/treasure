{"ast":null,"code":"import _regeneratorRuntime from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _wrapAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js\";\nimport _awaitAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js\";\nimport _asyncGeneratorDelegate from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncGeneratorDelegate.js\";\nimport _asyncIterator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";\nimport errCode from 'err-code';\nimport filter from 'it-filter';\nimport map from 'it-map';\n/**\n * Store the multiaddrs from every peer in the passed peer store\n */\nexport function storeAddresses(_x, _x2) {\n  return _storeAddresses.apply(this, arguments);\n}\n/**\n * Filter peers by unique peer id\n */\nfunction _storeAddresses() {\n  _storeAddresses = _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(source, peerStore) {\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          return _context2.delegateYield(_asyncGeneratorDelegate(_asyncIterator(map(source, /*#__PURE__*/function () {\n            var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(peer) {\n              return _regeneratorRuntime().wrap(function _callee$(_context) {\n                while (1) switch (_context.prev = _context.next) {\n                  case 0:\n                    _context.next = 2;\n                    return peerStore.addressBook.add(peer.id, peer.multiaddrs);\n                  case 2:\n                    return _context.abrupt(\"return\", peer);\n                  case 3:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }, _callee);\n            }));\n            return function (_x4) {\n              return _ref.apply(this, arguments);\n            };\n          }())), _awaitAsyncGenerator), \"t0\", 1);\n        case 1:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return _storeAddresses.apply(this, arguments);\n}\nexport function uniquePeers(source) {\n  /** @type Set<string> */\n  var seen = new Set();\n  return filter(source, function (peer) {\n    // dedupe by peer id\n    if (seen.has(peer.id.toString())) {\n      return false;\n    }\n    seen.add(peer.id.toString());\n    return true;\n  });\n}\n/**\n * Require at least `min` peers to be yielded from `source`\n */\nexport function requirePeers(_x3) {\n  return _requirePeers.apply(this, arguments);\n}\nfunction _requirePeers() {\n  _requirePeers = _wrapAsyncGenerator(function (source) {\n    var min = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n      var seen, _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, peer;\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            seen = 0;\n            _iteratorAbruptCompletion = false;\n            _didIteratorError = false;\n            _context3.prev = 3;\n            _iterator = _asyncIterator(source);\n          case 5:\n            _context3.next = 7;\n            return _awaitAsyncGenerator(_iterator.next());\n          case 7:\n            if (!(_iteratorAbruptCompletion = !(_step = _context3.sent).done)) {\n              _context3.next = 15;\n              break;\n            }\n            peer = _step.value;\n            seen++;\n            _context3.next = 12;\n            return peer;\n          case 12:\n            _iteratorAbruptCompletion = false;\n            _context3.next = 5;\n            break;\n          case 15:\n            _context3.next = 21;\n            break;\n          case 17:\n            _context3.prev = 17;\n            _context3.t0 = _context3[\"catch\"](3);\n            _didIteratorError = true;\n            _iteratorError = _context3.t0;\n          case 21:\n            _context3.prev = 21;\n            _context3.prev = 22;\n            if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n              _context3.next = 26;\n              break;\n            }\n            _context3.next = 26;\n            return _awaitAsyncGenerator(_iterator.return());\n          case 26:\n            _context3.prev = 26;\n            if (!_didIteratorError) {\n              _context3.next = 29;\n              break;\n            }\n            throw _iteratorError;\n          case 29:\n            return _context3.finish(26);\n          case 30:\n            return _context3.finish(21);\n          case 31:\n            if (!(seen < min)) {\n              _context3.next = 33;\n              break;\n            }\n            throw errCode(new Error('not found'), 'NOT_FOUND');\n          case 33:\n          case \"end\":\n            return _context3.stop();\n        }\n      }, _callee3, null, [[3, 17, 21, 31], [22,, 26, 30]]);\n    })();\n  });\n  return _requirePeers.apply(this, arguments);\n}","map":{"version":3,"names":["errCode","filter","map","storeAddresses","_x","_x2","_storeAddresses","apply","arguments","_wrapAsyncGenerator","_regeneratorRuntime","mark","_callee2","source","peerStore","wrap","_callee2$","_context2","prev","next","delegateYield","_asyncGeneratorDelegate","_asyncIterator","_ref","_asyncToGenerator","_callee","peer","_callee$","_context","addressBook","add","id","multiaddrs","abrupt","stop","_x4","_awaitAsyncGenerator","uniquePeers","seen","Set","has","toString","requirePeers","_x3","_requirePeers","min","length","undefined","_callee3","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","_callee3$","_context3","sent","done","value","t0","return","finish","Error"],"sources":["/Users/apple/Documents/treasure/node_modules/libp2p/src/content-routing/utils.ts"],"sourcesContent":["import errCode from 'err-code'\nimport filter from 'it-filter'\nimport map from 'it-map'\nimport type { Source } from 'it-stream-types'\nimport type { PeerInfo } from '@libp2p/interface-peer-info'\nimport type { PeerStore } from '@libp2p/interface-peer-store'\n\n/**\n * Store the multiaddrs from every peer in the passed peer store\n */\nexport async function * storeAddresses (source: Source<PeerInfo>, peerStore: PeerStore) {\n  yield * map(source, async (peer) => {\n    // ensure we have the addresses for a given peer\n    await peerStore.addressBook.add(peer.id, peer.multiaddrs)\n\n    return peer\n  })\n}\n\n/**\n * Filter peers by unique peer id\n */\nexport function uniquePeers (source: Source<PeerInfo>) {\n  /** @type Set<string> */\n  const seen = new Set()\n\n  return filter(source, (peer) => {\n    // dedupe by peer id\n    if (seen.has(peer.id.toString())) {\n      return false\n    }\n\n    seen.add(peer.id.toString())\n\n    return true\n  })\n}\n\n/**\n * Require at least `min` peers to be yielded from `source`\n */\nexport async function * requirePeers (source: Source<PeerInfo>, min: number = 1) {\n  let seen = 0\n\n  for await (const peer of source) {\n    seen++\n\n    yield peer\n  }\n\n  if (seen < min) {\n    throw errCode(new Error('not found'), 'NOT_FOUND')\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}