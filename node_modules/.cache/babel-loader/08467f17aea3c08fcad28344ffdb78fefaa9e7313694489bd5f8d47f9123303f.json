{"ast":null,"code":"import _regeneratorRuntime from\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import AirdropApi from\"api/AirdropApi\";import{useContractNFKeyStakingWithSigner}from\"hooks/blockchain/useHandleContracts\";import useHandleToken from\"hooks/token/useHandleToken\";import{useDispatch,useSelector}from\"react-redux\";import ACTIONS from\"redux/action\";import{selectNftSelected}from\"redux/slice/nftSlice\";import{selectUser}from\"redux/slice/userSlice\";export default function useUnlockTreasure(){var dispatch=useDispatch();var user=useSelector(selectUser);var nftSelected=useSelector(selectNftSelected);var handleToken=useHandleToken();var handleContractNFKeyStakingWithSigner=useContractNFKeyStakingWithSigner();var unlockTreasure=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var contractNFKeyStakingWithSigner;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return handleContractNFKeyStakingWithSigner;case 2:contractNFKeyStakingWithSigner=_context3.sent;return _context3.abrupt(\"return\",contractNFKeyStakingWithSigner.openChest(nftSelected===null||nftSelected===void 0?void 0:nftSelected.tokenId).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(tx){var _transaction$events;var transaction,_token,event,statusChest;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:new AirdropApi().logger({wallet_id:user===null||user===void 0?void 0:user.wallet_id,type:\"PENDING\",action:\"openChest\",description:\"tokenId: \".concat(nftSelected===null||nftSelected===void 0?void 0:nftSelected.tokenId),tx:JSON.stringify(tx)});_context.next=3;return tx.wait();case 3:transaction=_context.sent;_context.next=6;return handleToken.getcheckTxEvent(tx===null||tx===void 0?void 0:tx.hash,\"Opened\");case 6:_context.next=8;return handleToken.checkToken(nftSelected===null||nftSelected===void 0?void 0:nftSelected.tokenId);case 8:_token=_context.sent;if(_token){_context.next=11;break;}return _context.abrupt(\"return\");case 11:ACTIONS.SET_NFT_LIST_ITEM(dispatch,_token);ACTIONS.SET_NFT_SELECTED(dispatch,_token);ACTIONS.SET_TRANSANCTION_HASH(dispatch,tx===null||tx===void 0?void 0:tx.hash);event=transaction===null||transaction===void 0?void 0:(_transaction$events=transaction.events)===null||_transaction$events===void 0?void 0:_transaction$events.find(function(item){return(item===null||item===void 0?void 0:item.event)===\"Opened\";});statusChest=event===null||event===void 0?void 0:event.args[2];return _context.abrupt(\"return\",statusChest);case 17:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}()).catch(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(err){var _token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:new AirdropApi().logger({wallet_id:user===null||user===void 0?void 0:user.wallet_id,type:\"ERROR\",action:\"openChest\",description:\"tokenId: \".concat(nftSelected===null||nftSelected===void 0?void 0:nftSelected.tokenId),error:JSON.stringify(err)});_context2.next=3;return handleToken.checkToken(nftSelected===null||nftSelected===void 0?void 0:nftSelected.tokenId);case 3:_token=_context2.sent;if(_token){_context2.next=6;break;}return _context2.abrupt(\"return\");case 6:ACTIONS.SET_NFT_LIST_ITEM(dispatch,_token);ACTIONS.SET_NFT_SELECTED(dispatch,_token);throw err;case 9:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}()));case 4:case\"end\":return _context3.stop();}},_callee3);}));return function unlockTreasure(){return _ref.apply(this,arguments);};}();return{unlockTreasure:unlockTreasure};}","map":{"version":3,"names":["AirdropApi","useContractNFKeyStakingWithSigner","useHandleToken","useDispatch","useSelector","ACTIONS","selectNftSelected","selectUser","useUnlockTreasure","dispatch","user","nftSelected","handleToken","handleContractNFKeyStakingWithSigner","unlockTreasure","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee3","contractNFKeyStakingWithSigner","wrap","_callee3$","_context3","prev","next","sent","abrupt","openChest","tokenId","then","_ref2","_callee","tx","_transaction$events","transaction","_token","event","statusChest","_callee$","_context","logger","wallet_id","type","action","description","concat","JSON","stringify","wait","getcheckTxEvent","hash","checkToken","SET_NFT_LIST_ITEM","SET_NFT_SELECTED","SET_TRANSANCTION_HASH","events","find","item","args","stop","_x","apply","arguments","catch","_ref3","_callee2","err","_callee2$","_context2","error","_x2"],"sources":["/Users/apple/Documents/treasure/src/hooks/nft/useUnlockTreasure.js"],"sourcesContent":["import AirdropApi from \"api/AirdropApi\";\nimport { useContractNFKeyStakingWithSigner } from \"hooks/blockchain/useHandleContracts\";\nimport useHandleToken from \"hooks/token/useHandleToken\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport ACTIONS from \"redux/action\";\nimport { selectNftSelected } from \"redux/slice/nftSlice\";\nimport { selectUser } from \"redux/slice/userSlice\";\n\nexport default function useUnlockTreasure() {\n  const dispatch = useDispatch();\n  const user = useSelector(selectUser);\n  const nftSelected = useSelector(selectNftSelected);\n  const handleToken = useHandleToken();\n  const handleContractNFKeyStakingWithSigner =\n    useContractNFKeyStakingWithSigner();\n\n  const unlockTreasure = async () => {\n    const contractNFKeyStakingWithSigner =\n      await handleContractNFKeyStakingWithSigner;\n    return contractNFKeyStakingWithSigner\n      .openChest(nftSelected?.tokenId)\n      .then(async (tx) => {\n        new AirdropApi().logger({\n          wallet_id: user?.wallet_id,\n          type: \"PENDING\",\n          action: \"openChest\",\n          description: `tokenId: ${nftSelected?.tokenId}`,\n          tx: JSON.stringify(tx),\n        });\n        const transaction = await tx.wait();\n        await handleToken.getcheckTxEvent(tx?.hash, \"Opened\");\n        const _token = await handleToken.checkToken(nftSelected?.tokenId);\n        if (!_token) return;\n        ACTIONS.SET_NFT_LIST_ITEM(dispatch, _token);\n        ACTIONS.SET_NFT_SELECTED(dispatch, _token);\n        ACTIONS.SET_TRANSANCTION_HASH(dispatch, tx?.hash);\n        const event = transaction?.events?.find(\n          (item) => item?.event === \"Opened\"\n        );\n        const statusChest = event?.args[2];\n        return statusChest;\n      })\n      .catch(async (err) => {\n        new AirdropApi().logger({\n          wallet_id: user?.wallet_id,\n          type: \"ERROR\",\n          action: \"openChest\",\n          description: `tokenId: ${nftSelected?.tokenId}`,\n          error: JSON.stringify(err),\n        });\n\n        const _token = await handleToken.checkToken(nftSelected?.tokenId);\n        if (!_token) return;\n        ACTIONS.SET_NFT_LIST_ITEM(dispatch, _token);\n        ACTIONS.SET_NFT_SELECTED(dispatch, _token);\n        throw err;\n      });\n  };\n  return { unlockTreasure };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}