{"ast":null,"code":"import _regeneratorRuntime from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _asyncIterator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";\nimport batch from 'it-batch';\n\n/**\n * @typedef {import('../../types').FileDAGBuilder} FileDAGBuilder\n */\n\n/**\n * @type {FileDAGBuilder}\n */\nfunction balanced(source, reduce, options) {\n  return reduceToParents(source, reduce, options);\n}\n\n/**\n * @type {FileDAGBuilder}\n */\nfunction reduceToParents(_x, _x2, _x3) {\n  return _reduceToParents.apply(this, arguments);\n}\nfunction _reduceToParents() {\n  _reduceToParents = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(source, reduce, options) {\n    var roots, _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, chunked;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          roots = [];\n          _iteratorAbruptCompletion = false;\n          _didIteratorError = false;\n          _context.prev = 3;\n          _iterator = _asyncIterator(batch(source, options.maxChildrenPerNode));\n        case 5:\n          _context.next = 7;\n          return _iterator.next();\n        case 7:\n          if (!(_iteratorAbruptCompletion = !(_step = _context.sent).done)) {\n            _context.next = 17;\n            break;\n          }\n          chunked = _step.value;\n          _context.t0 = roots;\n          _context.next = 12;\n          return reduce(chunked);\n        case 12:\n          _context.t1 = _context.sent;\n          _context.t0.push.call(_context.t0, _context.t1);\n        case 14:\n          _iteratorAbruptCompletion = false;\n          _context.next = 5;\n          break;\n        case 17:\n          _context.next = 23;\n          break;\n        case 19:\n          _context.prev = 19;\n          _context.t2 = _context[\"catch\"](3);\n          _didIteratorError = true;\n          _iteratorError = _context.t2;\n        case 23:\n          _context.prev = 23;\n          _context.prev = 24;\n          if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n            _context.next = 28;\n            break;\n          }\n          _context.next = 28;\n          return _iterator.return();\n        case 28:\n          _context.prev = 28;\n          if (!_didIteratorError) {\n            _context.next = 31;\n            break;\n          }\n          throw _iteratorError;\n        case 31:\n          return _context.finish(28);\n        case 32:\n          return _context.finish(23);\n        case 33:\n          if (!(roots.length > 1)) {\n            _context.next = 35;\n            break;\n          }\n          return _context.abrupt(\"return\", reduceToParents(roots, reduce, options));\n        case 35:\n          return _context.abrupt(\"return\", roots[0]);\n        case 36:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee, null, [[3, 19, 23, 33], [24,, 28, 32]]);\n  }));\n  return _reduceToParents.apply(this, arguments);\n}\nexport default balanced;","map":{"version":3,"names":["batch","balanced","source","reduce","options","reduceToParents","_x","_x2","_x3","_reduceToParents","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","roots","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","chunked","wrap","_callee$","_context","prev","next","_asyncIterator","maxChildrenPerNode","sent","done","value","t0","t1","push","call","t2","return","finish","length","abrupt","stop"],"sources":["/Users/apple/Documents/treasure/node_modules/ipfs-unixfs-importer/src/dag-builder/file/balanced.js"],"sourcesContent":["import batch from 'it-batch'\n\n/**\n * @typedef {import('../../types').FileDAGBuilder} FileDAGBuilder\n */\n\n/**\n * @type {FileDAGBuilder}\n */\nfunction balanced (source, reduce, options) {\n  return reduceToParents(source, reduce, options)\n}\n\n/**\n * @type {FileDAGBuilder}\n */\nasync function reduceToParents (source, reduce, options) {\n  const roots = []\n\n  for await (const chunked of batch(source, options.maxChildrenPerNode)) {\n    roots.push(await reduce(chunked))\n  }\n\n  if (roots.length > 1) {\n    return reduceToParents(roots, reduce, options)\n  }\n\n  return roots[0]\n}\n\nexport default balanced\n"],"mappings":";;;AAAA,OAAOA,KAAK,MAAM,UAAU;;AAE5B;AACA;AACA;;AAEA;AACA;AACA;AACA,SAASC,QAAQA,CAAEC,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE;EAC1C,OAAOC,eAAe,CAACH,MAAM,EAAEC,MAAM,EAAEC,OAAO,CAAC;AACjD;;AAEA;AACA;AACA;AAFA,SAGeC,eAAeA,CAAAC,EAAA,EAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,gBAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAF,iBAAA;EAAAA,gBAAA,GAAAG,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAA9B,SAAAC,QAAgCb,MAAM,EAAEC,MAAM,EAAEC,OAAO;IAAA,IAAAY,KAAA,EAAAC,yBAAA,EAAAC,iBAAA,EAAAC,cAAA,EAAAC,SAAA,EAAAC,KAAA,EAAAC,OAAA;IAAA,OAAAT,mBAAA,GAAAU,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAC/CX,KAAK,GAAG,EAAE;UAAAC,yBAAA;UAAAC,iBAAA;UAAAO,QAAA,CAAAC,IAAA;UAAAN,SAAA,GAAAQ,cAAA,CAEY5B,KAAK,CAACE,MAAM,EAAEE,OAAO,CAACyB,kBAAkB,CAAC;QAAA;UAAAJ,QAAA,CAAAE,IAAA;UAAA,OAAAP,SAAA,CAAAO,IAAA;QAAA;UAAA,MAAAV,yBAAA,KAAAI,KAAA,GAAAI,QAAA,CAAAK,IAAA,EAAAC,IAAA;YAAAN,QAAA,CAAAE,IAAA;YAAA;UAAA;UAApDL,OAAO,GAAAD,KAAA,CAAAW,KAAA;UAAAP,QAAA,CAAAQ,EAAA,GACtBjB,KAAK;UAAAS,QAAA,CAAAE,IAAA;UAAA,OAAYxB,MAAM,CAACmB,OAAO,CAAC;QAAA;UAAAG,QAAA,CAAAS,EAAA,GAAAT,QAAA,CAAAK,IAAA;UAAAL,QAAA,CAAAQ,EAAA,CAA1BE,IAAI,CAAAC,IAAA,CAAAX,QAAA,CAAAQ,EAAA,EAAAR,QAAA,CAAAS,EAAA;QAAA;UAAAjB,yBAAA;UAAAQ,QAAA,CAAAE,IAAA;UAAA;QAAA;UAAAF,QAAA,CAAAE,IAAA;UAAA;QAAA;UAAAF,QAAA,CAAAC,IAAA;UAAAD,QAAA,CAAAY,EAAA,GAAAZ,QAAA;UAAAP,iBAAA;UAAAC,cAAA,GAAAM,QAAA,CAAAY,EAAA;QAAA;UAAAZ,QAAA,CAAAC,IAAA;UAAAD,QAAA,CAAAC,IAAA;UAAA,MAAAT,yBAAA,IAAAG,SAAA,CAAAkB,MAAA;YAAAb,QAAA,CAAAE,IAAA;YAAA;UAAA;UAAAF,QAAA,CAAAE,IAAA;UAAA,OAAAP,SAAA,CAAAkB,MAAA;QAAA;UAAAb,QAAA,CAAAC,IAAA;UAAA,KAAAR,iBAAA;YAAAO,QAAA,CAAAE,IAAA;YAAA;UAAA;UAAA,MAAAR,cAAA;QAAA;UAAA,OAAAM,QAAA,CAAAc,MAAA;QAAA;UAAA,OAAAd,QAAA,CAAAc,MAAA;QAAA;UAAA,MAGRvB,KAAK,CAACwB,MAAM,GAAG,CAAC;YAAAf,QAAA,CAAAE,IAAA;YAAA;UAAA;UAAA,OAAAF,QAAA,CAAAgB,MAAA,WACXpC,eAAe,CAACW,KAAK,EAAEb,MAAM,EAAEC,OAAO,CAAC;QAAA;UAAA,OAAAqB,QAAA,CAAAgB,MAAA,WAGzCzB,KAAK,CAAC,CAAC,CAAC;QAAA;QAAA;UAAA,OAAAS,QAAA,CAAAiB,IAAA;MAAA;IAAA,GAAA3B,OAAA;EAAA,CAChB;EAAA,OAAAN,gBAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAED,eAAeV,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}