{"ast":null,"code":"'use strict';\n\nvar _createClass = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _classCallCheck = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _inherits = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar _require = require('../abstract-iterator'),\n  AbstractIterator = _require.AbstractIterator,\n  AbstractKeyIterator = _require.AbstractKeyIterator,\n  AbstractValueIterator = _require.AbstractValueIterator;\nvar ModuleError = require('module-error');\nvar kNut = Symbol('nut');\nvar kUndefer = Symbol('undefer');\nvar kFactory = Symbol('factory');\nvar DeferredIterator = /*#__PURE__*/function (_AbstractIterator) {\n  _inherits(DeferredIterator, _AbstractIterator);\n  var _super = _createSuper(DeferredIterator);\n  function DeferredIterator(db, options) {\n    var _this;\n    _classCallCheck(this, DeferredIterator);\n    _this = _super.call(this, db, options);\n    _this[kNut] = null;\n    _this[kFactory] = function () {\n      return db.iterator(options);\n    };\n    _this.db.defer(function () {\n      return _this[kUndefer]();\n    });\n    return _this;\n  }\n  return _createClass(DeferredIterator);\n}(AbstractIterator);\nvar DeferredKeyIterator = /*#__PURE__*/function (_AbstractKeyIterator) {\n  _inherits(DeferredKeyIterator, _AbstractKeyIterator);\n  var _super2 = _createSuper(DeferredKeyIterator);\n  function DeferredKeyIterator(db, options) {\n    var _this2;\n    _classCallCheck(this, DeferredKeyIterator);\n    _this2 = _super2.call(this, db, options);\n    _this2[kNut] = null;\n    _this2[kFactory] = function () {\n      return db.keys(options);\n    };\n    _this2.db.defer(function () {\n      return _this2[kUndefer]();\n    });\n    return _this2;\n  }\n  return _createClass(DeferredKeyIterator);\n}(AbstractKeyIterator);\nvar DeferredValueIterator = /*#__PURE__*/function (_AbstractValueIterato) {\n  _inherits(DeferredValueIterator, _AbstractValueIterato);\n  var _super3 = _createSuper(DeferredValueIterator);\n  function DeferredValueIterator(db, options) {\n    var _this3;\n    _classCallCheck(this, DeferredValueIterator);\n    _this3 = _super3.call(this, db, options);\n    _this3[kNut] = null;\n    _this3[kFactory] = function () {\n      return db.values(options);\n    };\n    _this3.db.defer(function () {\n      return _this3[kUndefer]();\n    });\n    return _this3;\n  }\n  return _createClass(DeferredValueIterator);\n}(AbstractValueIterator);\nfor (var _i = 0, _arr = [DeferredIterator, DeferredKeyIterator, DeferredValueIterator]; _i < _arr.length; _i++) {\n  var Iterator = _arr[_i];\n  Iterator.prototype[kUndefer] = function () {\n    if (this.db.status === 'open') {\n      this[kNut] = this[kFactory]();\n    }\n  };\n  Iterator.prototype._next = function (callback) {\n    var _this4 = this;\n    if (this[kNut] !== null) {\n      this[kNut].next(callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(function () {\n        return _this4._next(callback);\n      });\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call next() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }));\n    }\n  };\n  Iterator.prototype._nextv = function (size, options, callback) {\n    var _this5 = this;\n    if (this[kNut] !== null) {\n      this[kNut].nextv(size, options, callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(function () {\n        return _this5._nextv(size, options, callback);\n      });\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call nextv() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }));\n    }\n  };\n  Iterator.prototype._all = function (options, callback) {\n    var _this6 = this;\n    if (this[kNut] !== null) {\n      this[kNut].all(callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(function () {\n        return _this6._all(options, callback);\n      });\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call all() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }));\n    }\n  };\n  Iterator.prototype._seek = function (target, options) {\n    var _this7 = this;\n    if (this[kNut] !== null) {\n      // TODO: explain why we need _seek() rather than seek() here\n      this[kNut]._seek(target, options);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(function () {\n        return _this7._seek(target, options);\n      });\n    }\n  };\n  Iterator.prototype._close = function (callback) {\n    var _this8 = this;\n    if (this[kNut] !== null) {\n      this[kNut].close(callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(function () {\n        return _this8._close(callback);\n      });\n    } else {\n      this.nextTick(callback);\n    }\n  };\n}\nexports.DeferredIterator = DeferredIterator;\nexports.DeferredKeyIterator = DeferredKeyIterator;\nexports.DeferredValueIterator = DeferredValueIterator;","map":{"version":3,"names":["_createClass","require","default","_classCallCheck","_inherits","_createSuper","_require","AbstractIterator","AbstractKeyIterator","AbstractValueIterator","ModuleError","kNut","Symbol","kUndefer","kFactory","DeferredIterator","_AbstractIterator","_super","db","options","_this","call","iterator","defer","DeferredKeyIterator","_AbstractKeyIterator","_super2","_this2","keys","DeferredValueIterator","_AbstractValueIterato","_super3","_this3","values","_i","_arr","length","Iterator","prototype","status","_next","callback","_this4","next","nextTick","code","_nextv","size","_this5","nextv","_all","_this6","all","_seek","target","_this7","_close","_this8","close","exports"],"sources":["/Users/apple/Documents/treasure/node_modules/abstract-level/lib/deferred-iterator.js"],"sourcesContent":["'use strict'\n\nconst { AbstractIterator, AbstractKeyIterator, AbstractValueIterator } = require('../abstract-iterator')\nconst ModuleError = require('module-error')\n\nconst kNut = Symbol('nut')\nconst kUndefer = Symbol('undefer')\nconst kFactory = Symbol('factory')\n\nclass DeferredIterator extends AbstractIterator {\n  constructor (db, options) {\n    super(db, options)\n\n    this[kNut] = null\n    this[kFactory] = () => db.iterator(options)\n\n    this.db.defer(() => this[kUndefer]())\n  }\n}\n\nclass DeferredKeyIterator extends AbstractKeyIterator {\n  constructor (db, options) {\n    super(db, options)\n\n    this[kNut] = null\n    this[kFactory] = () => db.keys(options)\n\n    this.db.defer(() => this[kUndefer]())\n  }\n}\n\nclass DeferredValueIterator extends AbstractValueIterator {\n  constructor (db, options) {\n    super(db, options)\n\n    this[kNut] = null\n    this[kFactory] = () => db.values(options)\n\n    this.db.defer(() => this[kUndefer]())\n  }\n}\n\nfor (const Iterator of [DeferredIterator, DeferredKeyIterator, DeferredValueIterator]) {\n  Iterator.prototype[kUndefer] = function () {\n    if (this.db.status === 'open') {\n      this[kNut] = this[kFactory]()\n    }\n  }\n\n  Iterator.prototype._next = function (callback) {\n    if (this[kNut] !== null) {\n      this[kNut].next(callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._next(callback))\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call next() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }))\n    }\n  }\n\n  Iterator.prototype._nextv = function (size, options, callback) {\n    if (this[kNut] !== null) {\n      this[kNut].nextv(size, options, callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._nextv(size, options, callback))\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call nextv() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }))\n    }\n  }\n\n  Iterator.prototype._all = function (options, callback) {\n    if (this[kNut] !== null) {\n      this[kNut].all(callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._all(options, callback))\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call all() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }))\n    }\n  }\n\n  Iterator.prototype._seek = function (target, options) {\n    if (this[kNut] !== null) {\n      // TODO: explain why we need _seek() rather than seek() here\n      this[kNut]._seek(target, options)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._seek(target, options))\n    }\n  }\n\n  Iterator.prototype._close = function (callback) {\n    if (this[kNut] !== null) {\n      this[kNut].close(callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._close(callback))\n    } else {\n      this.nextTick(callback)\n    }\n  }\n}\n\nexports.DeferredIterator = DeferredIterator\nexports.DeferredKeyIterator = DeferredKeyIterator\nexports.DeferredValueIterator = DeferredValueIterator\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}