{"ast":null,"code":"import _regeneratorRuntime from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _awaitAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js\";\nimport _wrapAsyncGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js\";\nimport _asyncIterator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";\nimport errCode from 'err-code';\nimport { messages, codes } from '../errors.js';\n/**\n * Wrapper class to convert events into returned values\n */\nexport var DHTPeerRouting = /*#__PURE__*/function () {\n  function DHTPeerRouting(dht) {\n    _classCallCheck(this, DHTPeerRouting);\n    this.dht = dht;\n  }\n  _createClass(DHTPeerRouting, [{\n    key: \"findPeer\",\n    value: function () {\n      var _findPeer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(peerId) {\n        var options,\n          _iteratorAbruptCompletion,\n          _didIteratorError,\n          _iteratorError,\n          _iterator,\n          _step,\n          event,\n          _args = arguments;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n              _iteratorAbruptCompletion = false;\n              _didIteratorError = false;\n              _context.prev = 3;\n              _iterator = _asyncIterator(this.dht.findPeer(peerId, options));\n            case 5:\n              _context.next = 7;\n              return _iterator.next();\n            case 7:\n              if (!(_iteratorAbruptCompletion = !(_step = _context.sent).done)) {\n                _context.next = 14;\n                break;\n              }\n              event = _step.value;\n              if (!(event.name === 'FINAL_PEER')) {\n                _context.next = 11;\n                break;\n              }\n              return _context.abrupt(\"return\", event.peer);\n            case 11:\n              _iteratorAbruptCompletion = false;\n              _context.next = 5;\n              break;\n            case 14:\n              _context.next = 20;\n              break;\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](3);\n              _didIteratorError = true;\n              _iteratorError = _context.t0;\n            case 20:\n              _context.prev = 20;\n              _context.prev = 21;\n              if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n                _context.next = 25;\n                break;\n              }\n              _context.next = 25;\n              return _iterator.return();\n            case 25:\n              _context.prev = 25;\n              if (!_didIteratorError) {\n                _context.next = 28;\n                break;\n              }\n              throw _iteratorError;\n            case 28:\n              return _context.finish(25);\n            case 29:\n              return _context.finish(20);\n            case 30:\n              throw errCode(new Error(messages.NOT_FOUND), codes.ERR_NOT_FOUND);\n            case 31:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[3, 16, 20, 30], [21,, 25, 29]]);\n      }));\n      function findPeer(_x) {\n        return _findPeer.apply(this, arguments);\n      }\n      return findPeer;\n    }()\n  }, {\n    key: \"getClosestPeers\",\n    value: function getClosestPeers(key) {\n      var _this = this;\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _iteratorAbruptCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, event;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _iteratorAbruptCompletion2 = false;\n              _didIteratorError2 = false;\n              _context2.prev = 2;\n              _iterator2 = _asyncIterator(_this.dht.getClosestPeers(key, options));\n            case 4:\n              _context2.next = 6;\n              return _awaitAsyncGenerator(_iterator2.next());\n            case 6:\n              if (!(_iteratorAbruptCompletion2 = !(_step2 = _context2.sent).done)) {\n                _context2.next = 14;\n                break;\n              }\n              event = _step2.value;\n              if (!(event.name === 'FINAL_PEER')) {\n                _context2.next = 11;\n                break;\n              }\n              _context2.next = 11;\n              return event.peer;\n            case 11:\n              _iteratorAbruptCompletion2 = false;\n              _context2.next = 4;\n              break;\n            case 14:\n              _context2.next = 20;\n              break;\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](2);\n              _didIteratorError2 = true;\n              _iteratorError2 = _context2.t0;\n            case 20:\n              _context2.prev = 20;\n              _context2.prev = 21;\n              if (!(_iteratorAbruptCompletion2 && _iterator2.return != null)) {\n                _context2.next = 25;\n                break;\n              }\n              _context2.next = 25;\n              return _awaitAsyncGenerator(_iterator2.return());\n            case 25:\n              _context2.prev = 25;\n              if (!_didIteratorError2) {\n                _context2.next = 28;\n                break;\n              }\n              throw _iteratorError2;\n            case 28:\n              return _context2.finish(25);\n            case 29:\n              return _context2.finish(20);\n            case 30:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 16, 20, 30], [21,, 25, 29]]);\n      }))();\n    }\n  }]);\n  return DHTPeerRouting;\n}();","map":{"version":3,"names":["errCode","messages","codes","DHTPeerRouting","dht","_classCallCheck","_createClass","key","value","_findPeer","_asyncToGenerator","_regeneratorRuntime","mark","_callee","peerId","options","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","event","_args","arguments","wrap","_callee$","_context","prev","next","length","undefined","_asyncIterator","findPeer","sent","done","name","abrupt","peer","t0","return","finish","Error","NOT_FOUND","ERR_NOT_FOUND","stop","_x","apply","getClosestPeers","_this","_wrapAsyncGenerator","_callee2","_iteratorAbruptCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_callee2$","_context2","_awaitAsyncGenerator"],"sources":["/Users/apple/Documents/treasure/node_modules/libp2p/src/dht/dht-peer-routing.ts"],"sourcesContent":["import errCode from 'err-code'\nimport { messages, codes } from '../errors.js'\nimport type { PeerRouting } from '@libp2p/interface-peer-routing'\nimport type { DHT } from '@libp2p/interface-dht'\nimport type { PeerId } from '@libp2p/interface-peer-id'\nimport type { AbortOptions } from '@libp2p/interfaces'\n\n/**\n * Wrapper class to convert events into returned values\n */\nexport class DHTPeerRouting implements PeerRouting {\n  private readonly dht: DHT\n\n  constructor (dht: DHT) {\n    this.dht = dht\n  }\n\n  async findPeer (peerId: PeerId, options: AbortOptions = {}) {\n    for await (const event of this.dht.findPeer(peerId, options)) {\n      if (event.name === 'FINAL_PEER') {\n        return event.peer\n      }\n    }\n\n    throw errCode(new Error(messages.NOT_FOUND), codes.ERR_NOT_FOUND)\n  }\n\n  async * getClosestPeers (key: Uint8Array, options: AbortOptions = {}) {\n    for await (const event of this.dht.getClosestPeers(key, options)) {\n      if (event.name === 'FINAL_PEER') {\n        yield event.peer\n      }\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}