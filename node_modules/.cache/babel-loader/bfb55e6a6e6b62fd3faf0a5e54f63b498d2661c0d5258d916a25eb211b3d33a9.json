{"ast":null,"code":"import _regeneratorRuntime from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { NotFoundError } from '../errors.js';\n\n/**\n * @typedef {import('interface-datastore').Datastore} Datastore\n * @typedef {import('interface-datastore').Key} Key\n */\n\n/**\n * @param {Key} key\n * @param {function (Key): Promise<boolean>} has\n * @param {Datastore} store\n * @returns {Promise<boolean>}\n */\nexport function hasWithFallback(_x, _x2, _x3) {\n  return _hasWithFallback.apply(this, arguments);\n}\n\n/**\n * @param {import('interface-datastore').Key} key\n * @param {function (Key): Promise<Uint8Array>} get\n * @param {function (Key): Promise<boolean>} has\n * @param {import('interface-datastore').Datastore} store\n * @returns {Promise<Uint8Array>}\n */\nfunction _hasWithFallback() {\n  _hasWithFallback = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(key, has, store) {\n    var result, levelJs;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return has(key);\n        case 2:\n          result = _context.sent;\n          if (!result) {\n            _context.next = 5;\n            break;\n          }\n          return _context.abrupt(\"return\", result);\n        case 5:\n          // Newer versions of level.js changed the key type from Uint8Array|string\n          // to Uint8Array  so fall back to trying Uint8Arrays if we are using level.js\n          // and the string version of the key did not work\n          levelJs = findLevelJs(store);\n          if (levelJs) {\n            _context.next = 8;\n            break;\n          }\n          return _context.abrupt(\"return\", false);\n        case 8:\n          return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n            // drop down to IndexDB API, otherwise level-js will monkey around with the keys/values\n            // @ts-ignore\n            var req = levelJs.store('readonly').get(key.toString());\n            req.transaction.onabort = function () {\n              reject(req.transaction.error);\n            };\n            req.transaction.oncomplete = function () {\n              resolve(Boolean(req.result));\n            };\n          }));\n        case 9:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return _hasWithFallback.apply(this, arguments);\n}\nexport function getWithFallback(_x4, _x5, _x6, _x7) {\n  return _getWithFallback.apply(this, arguments);\n}\n\n/**\n * Level dbs wrap level dbs that wrap level dbs. Find a level-js\n * instance in the chain if one exists.\n *\n * @param {Datastore} store\n * @returns {Datastore | undefined}\n */\nfunction _getWithFallback() {\n  _getWithFallback = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(key, get, has, store) {\n    var levelJs;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return has(key);\n        case 2:\n          if (!_context2.sent) {\n            _context2.next = 4;\n            break;\n          }\n          return _context2.abrupt(\"return\", get(key));\n        case 4:\n          // Newer versions of level.js changed the key type from Uint8Array|string\n          // to Uint8Array so fall back to trying Uint8Arrays if we are using level.js\n          // and the string version of the key did not work\n          levelJs = findLevelJs(store);\n          if (levelJs) {\n            _context2.next = 7;\n            break;\n          }\n          throw new NotFoundError();\n        case 7:\n          return _context2.abrupt(\"return\", new Promise(function (resolve, reject) {\n            // drop down to IndexDB API, otherwise level-js will monkey around with the keys/values\n            // @ts-ignore\n            var req = levelJs.store('readonly').get(key.toString());\n            req.transaction.onabort = function () {\n              reject(req.transaction.error);\n            };\n            req.transaction.oncomplete = function () {\n              if (req.result) {\n                return resolve(req.result);\n              }\n              reject(new NotFoundError());\n            };\n          }));\n        case 8:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return _getWithFallback.apply(this, arguments);\n}\nfunction findLevelJs(store) {\n  var db = store;\n\n  // @ts-ignore\n  while (db.db || db.child) {\n    // @ts-ignore\n    db = db.db || db.child;\n\n    // `Level` is only present in the browser, in node it is LevelDOWN\n    // @ts-ignore\n    if (db.type === 'level-js' || db.constructor.name === 'Level') {\n      return db;\n    }\n  }\n}","map":{"version":3,"names":["NotFoundError","hasWithFallback","_x","_x2","_x3","_hasWithFallback","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","key","has","store","result","levelJs","wrap","_callee$","_context","prev","next","sent","abrupt","findLevelJs","Promise","resolve","reject","req","get","toString","transaction","onabort","error","oncomplete","Boolean","stop","getWithFallback","_x4","_x5","_x6","_x7","_getWithFallback","_callee2","_callee2$","_context2","db","child","type","constructor","name"],"sources":["/Users/apple/Documents/treasure/node_modules/ipfs-repo/src/utils/level.js"],"sourcesContent":["\nimport { NotFoundError } from '../errors.js'\n\n/**\n * @typedef {import('interface-datastore').Datastore} Datastore\n * @typedef {import('interface-datastore').Key} Key\n */\n\n/**\n * @param {Key} key\n * @param {function (Key): Promise<boolean>} has\n * @param {Datastore} store\n * @returns {Promise<boolean>}\n */\nexport async function hasWithFallback (key, has, store) {\n  const result = await has(key)\n\n  if (result) {\n    return result\n  }\n\n  // Newer versions of level.js changed the key type from Uint8Array|string\n  // to Uint8Array  so fall back to trying Uint8Arrays if we are using level.js\n  // and the string version of the key did not work\n  const levelJs = findLevelJs(store)\n\n  if (!levelJs) {\n    return false\n  }\n\n  return new Promise((resolve, reject) => {\n    // drop down to IndexDB API, otherwise level-js will monkey around with the keys/values\n    // @ts-ignore\n    const req = levelJs.store('readonly').get(key.toString())\n    req.transaction.onabort = () => {\n      reject(req.transaction.error)\n    }\n    req.transaction.oncomplete = () => {\n      resolve(Boolean(req.result))\n    }\n  })\n}\n\n/**\n * @param {import('interface-datastore').Key} key\n * @param {function (Key): Promise<Uint8Array>} get\n * @param {function (Key): Promise<boolean>} has\n * @param {import('interface-datastore').Datastore} store\n * @returns {Promise<Uint8Array>}\n */\nexport async function getWithFallback (key, get, has, store) {\n  if (await has(key)) {\n    return get(key)\n  }\n\n  // Newer versions of level.js changed the key type from Uint8Array|string\n  // to Uint8Array so fall back to trying Uint8Arrays if we are using level.js\n  // and the string version of the key did not work\n  const levelJs = findLevelJs(store)\n\n  if (!levelJs) {\n    throw new NotFoundError()\n  }\n\n  return new Promise((resolve, reject) => {\n    // drop down to IndexDB API, otherwise level-js will monkey around with the keys/values\n    // @ts-ignore\n    const req = levelJs.store('readonly').get(key.toString())\n    req.transaction.onabort = () => {\n      reject(req.transaction.error)\n    }\n    req.transaction.oncomplete = () => {\n      if (req.result) {\n        return resolve(req.result)\n      }\n\n      reject(new NotFoundError())\n    }\n  })\n}\n\n/**\n * Level dbs wrap level dbs that wrap level dbs. Find a level-js\n * instance in the chain if one exists.\n *\n * @param {Datastore} store\n * @returns {Datastore | undefined}\n */\nfunction findLevelJs (store) {\n  let db = store\n\n  // @ts-ignore\n  while (db.db || db.child) {\n    // @ts-ignore\n    db = db.db || db.child\n\n    // `Level` is only present in the browser, in node it is LevelDOWN\n    // @ts-ignore\n    if (db.type === 'level-js' || db.constructor.name === 'Level') {\n      return db\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}