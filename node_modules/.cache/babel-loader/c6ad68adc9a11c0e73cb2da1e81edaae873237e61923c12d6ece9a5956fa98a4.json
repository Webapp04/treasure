{"ast":null,"code":"import _slicedToArray from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _createForOfIteratorHelper from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _classCallCheck from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n/**\n * This is similar to https://github.com/daviddias/time-cache/blob/master/src/index.js\n * for our own need, we don't use lodash throttle to improve performance.\n * This gives 4x - 5x performance gain compared to npm TimeCache\n */\nexport var SimpleTimeCache = /*#__PURE__*/function () {\n  function SimpleTimeCache(opts) {\n    _classCallCheck(this, SimpleTimeCache);\n    this.entries = new Map();\n    this.validityMs = opts.validityMs;\n    // allow negative validityMs so that this does not cache anything, spec test compliance.spec.js\n    // sends duplicate messages and expect peer to receive all. Application likely uses positive validityMs\n  }\n  _createClass(SimpleTimeCache, [{\n    key: \"size\",\n    get: function get() {\n      return this.entries.size;\n    }\n  }, {\n    key: \"put\",\n    value: function put(key, value) {\n      this.entries.set(key, {\n        value: value,\n        validUntilMs: Date.now() + this.validityMs\n      });\n    }\n  }, {\n    key: \"prune\",\n    value: function prune() {\n      var now = Date.now();\n      var _iterator = _createForOfIteratorHelper(this.entries.entries()),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var _step$value = _slicedToArray(_step.value, 2),\n            k = _step$value[0],\n            v = _step$value[1];\n          if (v.validUntilMs < now) {\n            this.entries.delete(k);\n          } else {\n            // sort by insertion order\n            break;\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }, {\n    key: \"has\",\n    value: function has(key) {\n      return this.entries.has(key);\n    }\n  }, {\n    key: \"get\",\n    value: function get(key) {\n      var value = this.entries.get(key);\n      return value && value.validUntilMs >= Date.now() ? value.value : undefined;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.entries.clear();\n    }\n  }]);\n  return SimpleTimeCache;\n}();","map":{"version":3,"names":["SimpleTimeCache","opts","_classCallCheck","entries","Map","validityMs","_createClass","key","get","size","value","put","set","validUntilMs","Date","now","prune","_iterator","_createForOfIteratorHelper","_step","s","n","done","_step$value","_slicedToArray","k","v","delete","err","e","f","has","undefined","clear"],"sources":["../../../src/utils/time-cache.ts"],"sourcesContent":[null],"mappings":";;;;AASA;;;;;AAKA,WAAaA,eAAe;EAI1B,SAAAA,gBAAYC,IAAyB;IAAAC,eAAA,OAAAF,eAAA;IAHpB,KAAAG,OAAO,GAAG,IAAIC,GAAG,EAAyB;IAIzD,IAAI,CAACC,UAAU,GAAGJ,IAAI,CAACI,UAAU;IAEjC;IACA;EACF;EAACC,YAAA,CAAAN,eAAA;IAAAO,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAQ;MACN,OAAO,IAAI,CAACL,OAAO,CAACM,IAAI;IAC1B;EAAC;IAAAF,GAAA;IAAAG,KAAA,EAED,SAAAC,IAAIJ,GAAW,EAAEG,KAAQ;MACvB,IAAI,CAACP,OAAO,CAACS,GAAG,CAACL,GAAG,EAAE;QAAEG,KAAK,EAALA,KAAK;QAAEG,YAAY,EAAEC,IAAI,CAACC,GAAG,EAAE,GAAG,IAAI,CAACV;MAAU,CAAE,CAAC;IAC9E;EAAC;IAAAE,GAAA;IAAAG,KAAA,EAED,SAAAM,MAAA,EAAK;MACH,IAAMD,GAAG,GAAGD,IAAI,CAACC,GAAG,EAAE;MAAA,IAAAE,SAAA,GAAAC,0BAAA,CAED,IAAI,CAACf,OAAO,CAACA,OAAO,EAAE;QAAAgB,KAAA;MAAA;QAA3C,KAAAF,SAAA,CAAAG,CAAA,MAAAD,KAAA,GAAAF,SAAA,CAAAI,CAAA,IAAAC,IAAA,GAA6C;UAAA,IAAAC,WAAA,GAAAC,cAAA,CAAAL,KAAA,CAAAT,KAAA;YAAjCe,CAAC,GAAAF,WAAA;YAAEG,CAAC,GAAAH,WAAA;UACd,IAAIG,CAAC,CAACb,YAAY,GAAGE,GAAG,EAAE;YACxB,IAAI,CAACZ,OAAO,CAACwB,MAAM,CAACF,CAAC,CAAC;WACvB,MAAM;YACL;YACA;;;MAEH,SAAAG,GAAA;QAAAX,SAAA,CAAAY,CAAA,CAAAD,GAAA;MAAA;QAAAX,SAAA,CAAAa,CAAA;MAAA;IACH;EAAC;IAAAvB,GAAA;IAAAG,KAAA,EAED,SAAAqB,IAAIxB,GAAW;MACb,OAAO,IAAI,CAACJ,OAAO,CAAC4B,GAAG,CAACxB,GAAG,CAAC;IAC9B;EAAC;IAAAA,GAAA;IAAAG,KAAA,EAED,SAAAF,IAAID,GAAW;MACb,IAAMG,KAAK,GAAG,IAAI,CAACP,OAAO,CAACK,GAAG,CAACD,GAAG,CAAC;MACnC,OAAOG,KAAK,IAAIA,KAAK,CAACG,YAAY,IAAIC,IAAI,CAACC,GAAG,EAAE,GAAGL,KAAK,CAACA,KAAK,GAAGsB,SAAS;IAC5E;EAAC;IAAAzB,GAAA;IAAAG,KAAA,EAED,SAAAuB,MAAA,EAAK;MACH,IAAI,CAAC9B,OAAO,CAAC8B,KAAK,EAAE;IACtB;EAAC;EAAA,OAAAjC,eAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}