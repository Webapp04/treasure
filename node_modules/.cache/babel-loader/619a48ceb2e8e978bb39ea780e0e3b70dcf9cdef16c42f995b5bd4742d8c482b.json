{"ast":null,"code":"var _classCallCheck = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/apple/Documents/treasure/node_modules/@babel/runtime/helpers/createClass.js\").default;\nmodule.exports = /*#__PURE__*/function () {\n  \"use strict\";\n\n  function BlockedKeys() {\n    _classCallCheck(this, BlockedKeys);\n    this._keys = {}; // {'key': 1526279430331}\n    this._addedKeysAmount = 0;\n  }\n  _createClass(BlockedKeys, [{\n    key: \"collectExpired\",\n    value: function collectExpired() {\n      var _this = this;\n      var now = Date.now();\n      Object.keys(this._keys).forEach(function (key) {\n        if (_this._keys[key] <= now) {\n          delete _this._keys[key];\n        }\n      });\n      this._addedKeysAmount = Object.keys(this._keys).length;\n    }\n\n    /**\n     * Add new blocked key\n     *\n     * @param key String\n     * @param sec Number\n     */\n  }, {\n    key: \"add\",\n    value: function add(key, sec) {\n      this.addMs(key, sec * 1000);\n    }\n\n    /**\n     * Add new blocked key for ms\n     *\n     * @param key String\n     * @param ms Number\n     */\n  }, {\n    key: \"addMs\",\n    value: function addMs(key, ms) {\n      this._keys[key] = Date.now() + ms;\n      this._addedKeysAmount++;\n      if (this._addedKeysAmount > 999) {\n        this.collectExpired();\n      }\n    }\n\n    /**\n     * 0 means not blocked\n     *\n     * @param key\n     * @returns {number}\n     */\n  }, {\n    key: \"msBeforeExpire\",\n    value: function msBeforeExpire(key) {\n      var expire = this._keys[key];\n      if (expire && expire >= Date.now()) {\n        this.collectExpired();\n        var now = Date.now();\n        return expire >= now ? expire - now : 0;\n      }\n      return 0;\n    }\n\n    /**\n     * If key is not given, delete all data in memory\n     * \n     * @param {string|undefined} key\n     */\n  }, {\n    key: \"delete\",\n    value: function _delete(key) {\n      var _this2 = this;\n      if (key) {\n        delete this._keys[key];\n      } else {\n        Object.keys(this._keys).forEach(function (key) {\n          delete _this2._keys[key];\n        });\n      }\n    }\n  }]);\n  return BlockedKeys;\n}();","map":{"version":3,"names":["module","exports","BlockedKeys","_classCallCheck","_keys","_addedKeysAmount","_createClass","key","value","collectExpired","_this","now","Date","Object","keys","forEach","length","add","sec","addMs","ms","msBeforeExpire","expire","_delete","_this2"],"sources":["/Users/apple/Documents/treasure/node_modules/rate-limiter-flexible/lib/component/BlockedKeys/BlockedKeys.js"],"sourcesContent":["module.exports = class BlockedKeys {\n  constructor() {\n    this._keys = {}; // {'key': 1526279430331}\n    this._addedKeysAmount = 0;\n  }\n\n  collectExpired() {\n    const now = Date.now();\n\n    Object.keys(this._keys).forEach((key) => {\n      if (this._keys[key] <= now) {\n        delete this._keys[key];\n      }\n    });\n\n    this._addedKeysAmount = Object.keys(this._keys).length;\n  }\n\n  /**\n   * Add new blocked key\n   *\n   * @param key String\n   * @param sec Number\n   */\n  add(key, sec) {\n    this.addMs(key, sec * 1000);\n  }\n\n  /**\n   * Add new blocked key for ms\n   *\n   * @param key String\n   * @param ms Number\n   */\n  addMs(key, ms) {\n    this._keys[key] = Date.now() + ms;\n    this._addedKeysAmount++;\n    if (this._addedKeysAmount > 999) {\n      this.collectExpired();\n    }\n  }\n\n  /**\n   * 0 means not blocked\n   *\n   * @param key\n   * @returns {number}\n   */\n  msBeforeExpire(key) {\n    const expire = this._keys[key];\n\n    if (expire && expire >= Date.now()) {\n      this.collectExpired();\n      const now = Date.now();\n      return expire >= now ? expire - now : 0;\n    }\n\n    return 0;\n  }\n\n  /**\n   * If key is not given, delete all data in memory\n   * \n   * @param {string|undefined} key\n   */\n  delete(key) {\n    if (key) {\n      delete this._keys[key];\n    } else {\n      Object.keys(this._keys).forEach((key) => {\n        delete this._keys[key];\n      });\n    }\n  }\n};\n"],"mappings":";;AAAAA,MAAM,CAACC,OAAO;EAAA;;EACZ,SAAAC,YAAA,EAAc;IAAAC,eAAA,OAAAD,WAAA;IACZ,IAAI,CAACE,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;IACjB,IAAI,CAACC,gBAAgB,GAAG,CAAC;EAC3B;EAACC,YAAA,CAAAJ,WAAA;IAAAK,GAAA;IAAAC,KAAA,EAED,SAAAC,eAAA,EAAiB;MAAA,IAAAC,KAAA;MACf,IAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;MAEtBE,MAAM,CAACC,IAAI,CAAC,IAAI,CAACV,KAAK,CAAC,CAACW,OAAO,CAAC,UAACR,GAAG,EAAK;QACvC,IAAIG,KAAI,CAACN,KAAK,CAACG,GAAG,CAAC,IAAII,GAAG,EAAE;UAC1B,OAAOD,KAAI,CAACN,KAAK,CAACG,GAAG,CAAC;QACxB;MACF,CAAC,CAAC;MAEF,IAAI,CAACF,gBAAgB,GAAGQ,MAAM,CAACC,IAAI,CAAC,IAAI,CAACV,KAAK,CAAC,CAACY,MAAM;IACxD;;IAEA;AACF;AACA;AACA;AACA;AACA;EALE;IAAAT,GAAA;IAAAC,KAAA,EAMA,SAAAS,IAAIV,GAAG,EAAEW,GAAG,EAAE;MACZ,IAAI,CAACC,KAAK,CAACZ,GAAG,EAAEW,GAAG,GAAG,IAAI,CAAC;IAC7B;;IAEA;AACF;AACA;AACA;AACA;AACA;EALE;IAAAX,GAAA;IAAAC,KAAA,EAMA,SAAAW,MAAMZ,GAAG,EAAEa,EAAE,EAAE;MACb,IAAI,CAAChB,KAAK,CAACG,GAAG,CAAC,GAAGK,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGS,EAAE;MACjC,IAAI,CAACf,gBAAgB,EAAE;MACvB,IAAI,IAAI,CAACA,gBAAgB,GAAG,GAAG,EAAE;QAC/B,IAAI,CAACI,cAAc,CAAC,CAAC;MACvB;IACF;;IAEA;AACF;AACA;AACA;AACA;AACA;EALE;IAAAF,GAAA;IAAAC,KAAA,EAMA,SAAAa,eAAed,GAAG,EAAE;MAClB,IAAMe,MAAM,GAAG,IAAI,CAAClB,KAAK,CAACG,GAAG,CAAC;MAE9B,IAAIe,MAAM,IAAIA,MAAM,IAAIV,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;QAClC,IAAI,CAACF,cAAc,CAAC,CAAC;QACrB,IAAME,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;QACtB,OAAOW,MAAM,IAAIX,GAAG,GAAGW,MAAM,GAAGX,GAAG,GAAG,CAAC;MACzC;MAEA,OAAO,CAAC;IACV;;IAEA;AACF;AACA;AACA;AACA;EAJE;IAAAJ,GAAA;IAAAC,KAAA,EAKA,SAAAe,QAAOhB,GAAG,EAAE;MAAA,IAAAiB,MAAA;MACV,IAAIjB,GAAG,EAAE;QACP,OAAO,IAAI,CAACH,KAAK,CAACG,GAAG,CAAC;MACxB,CAAC,MAAM;QACLM,MAAM,CAACC,IAAI,CAAC,IAAI,CAACV,KAAK,CAAC,CAACW,OAAO,CAAC,UAACR,GAAG,EAAK;UACvC,OAAOiB,MAAI,CAACpB,KAAK,CAACG,GAAG,CAAC;QACxB,CAAC,CAAC;MACJ;IACF;EAAC;EAAA,OAAAL,WAAA;AAAA,GACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}